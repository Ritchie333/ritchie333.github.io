<!DOCTYPE html>
<html>
<head>
<title>Dynamite Dan: Routine at EF1E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Dynamite Dan</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61169.html">EEF1</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61214">Map</a></td>
<td class="next">
Next: <a href="61256.html">EF48</a>
</td>
</tr>
</table>
<div class="description">EF1E: Initialize moving objects in all rooms</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="51329.html">C881</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61214"></span>
<div class="comments">
<div class="paragraph">
This routine loops through every moving object's movement table, and sets its visible flag, so that everything is in play when the game begins.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="61214"></span>EF1E</td>
<td class="instruction">LD HL,($69ED)</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the moving objects buffer. (<a href="27110.html">69E6</a> + 7 / 8)</td>
</tr>
<tr>
<td class="address-1"><span id="61217"></span>EF21</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Skip the first four bytes which hold the object IDs.</td>
</tr>
<tr>
<td class="address-1"><span id="61218"></span>EF22</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="61219"></span>EF23</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="61220"></span>EF24</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="61221"></span>EF25</td>
<td class="instruction">LD B,$30</td>
<td class="comment-1" rowspan="1">30 rooms to check.</td>
</tr>
<tr>
<td class="address-2"><span id="61223"></span>EF27</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Remember <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61224"></span>EF28</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the first byte with the number of objects.</td>
</tr>
<tr>
<td class="address-1"><span id="61225"></span>EF29</td>
<td class="instruction">CALL <a href="59896.html">$E9F8</a></td>
<td class="comment-1" rowspan="1">Split the two 4-bit numbers into <span class="register">B</span> and <span class="register">C</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61228"></span>EF2C</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="3">Put the combined total in <span class="register">D</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61229"></span>EF2D</td>
<td class="instruction">ADD A,C</td>
</tr>
<tr>
<td class="address-1"><span id="61230"></span>EF2E</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-1"><span id="61231"></span>EF2F</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Get the second byte with the number of objects.</td>
</tr>
<tr>
<td class="address-1"><span id="61232"></span>EF30</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="61233"></span>EF31</td>
<td class="instruction">CALL <a href="59896.html">$E9F8</a></td>
<td class="comment-1" rowspan="1">Split the two 4-bit numbers into <span class="register">B</span> and <span class="register">C</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61236"></span>EF34</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="4">Put the combined total, plus the earlier total in <span class="register">B</span> as the number of moving objects in this room.</td>
</tr>
<tr>
<td class="address-1"><span id="61237"></span>EF35</td>
<td class="instruction">ADD A,C</td>
</tr>
<tr>
<td class="address-1"><span id="61238"></span>EF36</td>
<td class="instruction">ADD A,D</td>
</tr>
<tr>
<td class="address-1"><span id="61239"></span>EF37</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="61240"></span>EF38</td>
<td class="instruction">LD DE,$0005</td>
<td class="comment-1" rowspan="2">Move to the start of the movement table.</td>
</tr>
<tr>
<td class="address-1"><span id="61243"></span>EF3B</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-2"><span id="61244"></span>EF3C</td>
<td class="instruction">RES 6,(HL)</td>
<td class="comment-1" rowspan="1">Set the sprite to be drawn.</td>
</tr>
<tr>
<td class="address-1"><span id="61246"></span>EF3E</td>
<td class="instruction">LD DE,$0008</td>
<td class="comment-1" rowspan="2">Move to the next movement entry.</td>
</tr>
<tr>
<td class="address-1"><span id="61249"></span>EF41</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="61250"></span>EF42</td>
<td class="instruction">DJNZ $EF3C</td>
<td class="comment-1" rowspan="1">Loop while there are more objects to look at it.</td>
</tr>
<tr>
<td class="address-1"><span id="61252"></span>EF44</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61253"></span>EF45</td>
<td class="instruction">DJNZ $EF27</td>
<td class="comment-1" rowspan="2">Loop back until all rooms have been checked.</td>
</tr>
<tr>
<td class="address-1"><span id="61255"></span>EF47</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61169.html">EEF1</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61214">Map</a></td>
<td class="next">
Next: <a href="61256.html">EF48</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Rod Bowkett / Mirrorsoft 1985. This dissassembly by Ritchie Swann 2019-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>