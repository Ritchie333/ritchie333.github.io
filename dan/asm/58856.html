<!DOCTYPE html>
<html>
<head>
<title>Dynamite Dan: Routine at E5E8</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Dynamite Dan</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="58770.html">E592</a>
</td>
<td class="up">Up: <a href="../maps/all.html#58856">Map</a></td>
<td class="next">
Next: <a href="58927.html">E62F</a>
</td>
</tr>
</table>
<div class="description">E5E8: See if Dan is in the blimp with the plans, and if so, launch it</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="51200.html">C800</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="58856"></span>E5E8</td>
<td class="instruction">LD HL,$C87E</td>
<td class="comment-1" rowspan="1">Get the game flags. (<a href="51326.html">C87E</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="58859"></span>E5EB</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the blimp been launched?</td>
</tr>
<tr>
<td class="address-1"><span id="58861"></span>E5ED</td>
<td class="instruction">JR NZ,<a href="58927.html">$E62F</a></td>
<td class="comment-1" rowspan="1">Display the winning text if so.</td>
</tr>
<tr>
<td class="address-1"><span id="58863"></span>E5EF</td>
<td class="instruction">LD A,($CFCA)</td>
<td class="comment-1" rowspan="1">Get the current room. (<a href="53194.html">CFCA</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="58866"></span>E5F2</td>
<td class="instruction">CP $2B</td>
<td class="comment-1" rowspan="1">Is it the start room? (2B)?</td>
</tr>
<tr>
<td class="address-1"><span id="58868"></span>E5F4</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not.</td>
</tr>
<tr>
<td class="address-1"><span id="58869"></span>E5F5</td>
<td class="instruction">LD A,$02</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="58871"></span>E5F7</td>
<td class="instruction">LD ($CFD3),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="58874"></span>E5FA</td>
<td class="instruction">LD A,($C872)</td>
<td class="comment-1" rowspan="2">Is the Y co-ordinate 16?</td>
</tr>
<tr>
<td class="address-1"><span id="58877"></span>E5FD</td>
<td class="instruction">CP $16</td>
</tr>
<tr>
<td class="address-1"><span id="58879"></span>E5FF</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not.</td>
</tr>
<tr>
<td class="address-1"><span id="58880"></span>E600</td>
<td class="instruction">LD A,($C873)</td>
<td class="comment-1" rowspan="3">Is the X co-ordinate between 08 and 14?</td>
</tr>
<tr>
<td class="address-1"><span id="58883"></span>E603</td>
<td class="instruction">SUB $0C</td>
</tr>
<tr>
<td class="address-1"><span id="58885"></span>E605</td>
<td class="instruction">CP $08</td>
</tr>
<tr>
<td class="address-1"><span id="58887"></span>E607</td>
<td class="instruction">RET NC</td>
<td class="comment-1" rowspan="1">Return if not.</td>
</tr>
<tr>
<td class="address-1"><span id="58888"></span>E608</td>
<td class="instruction">BIT 1,(HL)</td>
<td class="comment-1" rowspan="1">Does Dan have the plans?</td>
</tr>
<tr>
<td class="address-1"><span id="58890"></span>E60A</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58891"></span>
<div class="comments">
<div class="paragraph">
Dan is in the blimp and has the plans. Launch it.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="58891"></span>E60B</td>
<td class="instruction">LD (HL),$80</td>
<td class="comment-1" rowspan="1">Set bit 7 to denote Dan has the plans, clear all other flags.</td>
</tr>
<tr>
<td class="address-1"><span id="58893"></span>E60D</td>
<td class="instruction">LD HL,$40B0</td>
<td class="comment-1" rowspan="1">Starting screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="58896"></span>E610</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Loop 8 times.</td>
</tr>
<tr>
<td class="address-1"><span id="58898"></span>E612</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-1" rowspan="1">Load <span class="register">A</span> with all bits set.</td>
</tr>
<tr>
<td class="address-2"><span id="58900"></span>E614</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Remember the current screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="58901"></span>E615</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="5">Set the next three columns to this.</td>
</tr>
<tr>
<td class="address-1"><span id="58902"></span>E616</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="58903"></span>E617</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="58904"></span>E618</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="58905"></span>E619</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="58906"></span>E61A</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="58907"></span>E61B</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Move down a row.</td>
</tr>
<tr>
<td class="address-1"><span id="58908"></span>E61C</td>
<td class="instruction">DJNZ $E614</td>
<td class="comment-1" rowspan="1">Loop until the number of rows has been scrolled.</td>
</tr>
<tr>
<td class="address-1"><span id="58910"></span>E61E</td>
<td class="instruction">LD HL,$5855</td>
<td class="comment-1" rowspan="1">Starting attribute address.</td>
</tr>
<tr>
<td class="address-1"><span id="58913"></span>E621</td>
<td class="instruction">LD (HL),$06</td>
<td class="comment-1" rowspan="1">Set yellow on black.</td>
</tr>
<tr>
<td class="address-1"><span id="58915"></span>E623</td>
<td class="instruction">LD BC,$0904</td>
<td class="comment-1" rowspan="1">Fill for 9 columns, 4 rows.</td>
</tr>
<tr>
<td class="address-1"><span id="58918"></span>E626</td>
<td class="instruction">LD DE,$0C05</td>
<td class="comment-1" rowspan="1">Start at co-ordinate 0C 05.</td>
</tr>
<tr>
<td class="address-1"><span id="58921"></span>E629</td>
<td class="instruction">LD A,$05</td>
<td class="comment-1" rowspan="2">Fill with cyan on black.</td>
</tr>
<tr>
<td class="address-1"><span id="58923"></span>E62B</td>
<td class="instruction">CALL <a href="59578.html">$E8BA</a></td>
</tr>
<tr>
<td class="address-1"><span id="58926"></span>E62E</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return for another run round the main loop.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="58770.html">E592</a>
</td>
<td class="up">Up: <a href="../maps/all.html#58856">Map</a></td>
<td class="next">
Next: <a href="58927.html">E62F</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Rod Bowkett / Mirrorsoft 1985. This dissassembly by Ritchie Swann 2019-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>