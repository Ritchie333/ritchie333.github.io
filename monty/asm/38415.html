<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at 960F</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="38376.html">95E8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#38415">Map</a></td>
<td class="next">
Next: <a href="38467.html">9643</a>
</td>
</tr>
</table>
<div class="description">960F: Draw the coal in the room</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="38323.html">95B3</a> and <a href="38570.html">96AA</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Pointer to coal information (offset from <a href="50495.html">C53F</a>)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="38415"></span>960F</td>
<td class="instruction">LD B,(IX+$02)</td>
<td class="comment-1" rowspan="9">Convert the Y co-ordinate to a screen address and put it in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="38418"></span>9612</td>
<td class="instruction">LD A,$18</td>
</tr>
<tr>
<td class="address-1"><span id="38420"></span>9614</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="address-1"><span id="38421"></span>9615</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="38422"></span>9616</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="38423"></span>9617</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="38424"></span>9618</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="38425"></span>9619</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="38426"></span>961A</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="38428"></span>961C</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="1">Double it to get an appropriate entry in the screen address table.</td>
</tr>
<tr>
<td class="address-1"><span id="38429"></span>961D</td>
<td class="instruction">LD DE,$EA60</td>
<td class="comment-1" rowspan="2">Add the basic address of the screen address table to get the right entry.</td>
</tr>
<tr>
<td class="address-1"><span id="38432"></span>9620</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="38433"></span>9621</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Put the actual screen address in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="38434"></span>9622</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="38435"></span>9623</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="38436"></span>9624</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="38437"></span>9625</td>
<td class="instruction">LD E,(IX+$01)</td>
<td class="comment-1" rowspan="3">Add the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="38440"></span>9628</td>
<td class="instruction">LD D,$00</td>
</tr>
<tr>
<td class="address-1"><span id="38442"></span>962A</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="38443"></span>962B</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="3">Add an offset to give an address in the screen buffer from <a href="53856.html">D260</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="38444"></span>962C</td>
<td class="instruction">LD HL,$9260</td>
</tr>
<tr>
<td class="address-1"><span id="38447"></span>962F</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="38448"></span>9630</td>
<td class="instruction">LD IY,$C537</td>
<td class="comment-1" rowspan="1">Point <span class="register">IY</span> at the coal UDG.</td>
</tr>
<tr>
<td class="address-1"><span id="38452"></span>9634</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">8 rows to draw.</td>
</tr>
<tr>
<td class="address-2"><span id="38454"></span>9636</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="1">Get the graphic data.</td>
</tr>
<tr>
<td class="address-1"><span id="38457"></span>9639</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Invert it.</td>
</tr>
<tr>
<td class="address-1"><span id="38458"></span>963A</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">Store it on the screen and in the screen buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="38459"></span>963B</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="38460"></span>963C</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move to the next row on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="38461"></span>963D</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Move to the next row in the screen buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="38462"></span>963E</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1">Move to the next graphic data.</td>
</tr>
<tr>
<td class="address-1"><span id="38464"></span>9640</td>
<td class="instruction">DJNZ $9636</td>
<td class="comment-1" rowspan="2">Loop while there are more rows to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="38466"></span>9642</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="38376.html">95E8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#38415">Map</a></td>
<td class="next">
Next: <a href="38467.html">9643</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>