<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at F71A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63229.html">F6FD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63258">Map</a></td>
<td class="next">
Next: <a href="63368.html">F788</a>
</td>
</tr>
</table>
<div class="description">F71A: Hide a wall after enough coal has been collected</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the entry point at <a href="63142.html">F6A6</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Y co-ordinate</td>
</tr>
<tr>
<td class="register">L</td>
<td class="register-desc">X co-ordinate</td>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">Width</td>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Pointer to wall flags at <a href="63441.html">F7D1</a>.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="63258"></span>F71A</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Remember <span class="register">HL</span> and <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="63259"></span>F71B</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="63260"></span>F71C</td>
<td class="instruction">LD A,($F7D4)</td>
<td class="comment-1" rowspan="1">Get the current frame number.</td>
</tr>
<tr>
<td class="address-1"><span id="63263"></span>F71F</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="5">Subtract it from the base Y co-ordinate and store in <a href="63442.html">F7D2</a> and <a href="63443.html">F7D3</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="63265"></span>F721</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-1"><span id="63266"></span>F722</td>
<td class="instruction">LD E,$00</td>
</tr>
<tr>
<td class="address-1"><span id="63268"></span>F724</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63269"></span>F725</td>
<td class="instruction">LD ($F7D2),HL</td>
</tr>
<tr>
<td class="address-1"><span id="63272"></span>F728</td>
<td class="instruction">LD B,C</td>
<td class="comment-1" rowspan="1">Put the number of characters in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63273"></span>F729</td>
<td class="instruction">LD C,L</td>
<td class="comment-1" rowspan="4">Convert the Y co-ordinate to a offset for a screen address.</td>
</tr>
<tr>
<td class="address-2"><span id="63274"></span>F72A</td>
<td class="instruction">LD L,H</td>
</tr>
<tr>
<td class="address-1"><span id="63275"></span>F72B</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="63277"></span>F72D</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="63278"></span>F72E</td>
<td class="instruction">LD DE,$EA60</td>
<td class="comment-1" rowspan="2">Add to the base pointer at <a href="60000.html">EA60</a> to get a screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="63281"></span>F731</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63282"></span>F732</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Put the screen address in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63283"></span>F733</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="63284"></span>F734</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="63285"></span>F735</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="63286"></span>F736</td>
<td class="instruction">LD E,C</td>
<td class="comment-1" rowspan="3">Add the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63287"></span>F737</td>
<td class="instruction">LD D,$00</td>
</tr>
<tr>
<td class="address-1"><span id="63289"></span>F739</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63290"></span>F73A</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-1" rowspan="1">Erase the character.</td>
</tr>
<tr>
<td class="address-1"><span id="63292"></span>F73C</td>
<td class="instruction">LD DE,$9260</td>
<td class="comment-1" rowspan="3">Also erase it in the screen buffer (<a href="37464.html#37472">9260</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="63295"></span>F73F</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63296"></span>F740</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="address-2"><span id="63298"></span>F742</td>
<td class="instruction">LD HL,($F7D2)</td>
<td class="comment-1" rowspan="1">Get the wall position.</td>
</tr>
<tr>
<td class="address-1"><span id="63301"></span>F745</td>
<td class="instruction">LD DE,$F800</td>
<td class="comment-1" rowspan="2">Move to the next position by subtracting 8 from the Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63304"></span>F748</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="63305"></span>F749</td>
<td class="instruction">LD ($F7D2),HL</td>
<td class="comment-1" rowspan="1">Set this as the new position.</td>
</tr>
<tr>
<td class="address-1"><span id="63308"></span>F74C</td>
<td class="instruction">DJNZ $F72A</td>
<td class="comment-1" rowspan="1">Loop back if there are more characters to do.</td>
</tr>
<tr>
<td class="address-1"><span id="63310"></span>F74E</td>
<td class="instruction">LD A,($F7D4)</td>
<td class="comment-1" rowspan="1">Get current frame number.</td>
</tr>
<tr>
<td class="address-1"><span id="63313"></span>F751</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="2">Increment it, but if this reaches 8, reset to 0.</td>
</tr>
<tr>
<td class="address-1"><span id="63314"></span>F752</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="63316"></span>F754</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="2">Restore co-ordinates and width.</td>
</tr>
<tr>
<td class="address-1"><span id="63317"></span>F755</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address-1"><span id="63318"></span>F756</td>
<td class="instruction">LD ($F7D4),A</td>
<td class="comment-1" rowspan="2">Store next frame number and return if it is 0.</td>
</tr>
<tr>
<td class="address-1"><span id="63321"></span>F759</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63322"></span>
<div class="comments">
<div class="paragraph">
Erase the wall from the set of graphics, and change it to mid-air.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63322"></span>F75A</td>
<td class="instruction">LD IY,$C54E</td>
<td class="comment-1" rowspan="1"><a href="50510.html">C54E</a> is the store of static graphics for this room.</td>
</tr>
<tr>
<td class="address-1"><span id="63326"></span>F75E</td>
<td class="instruction">CALL <a href="63229.html">$F6FD</a></td>
<td class="comment-1" rowspan="1">Erase the wall.</td>
</tr>
<tr>
<td class="address-1"><span id="63329"></span>F761</td>
<td class="instruction">RES 0,(IX+$00)</td>
<td class="comment-1" rowspan="1">Clear the flag to mark a wall as being erased.</td>
</tr>
<tr>
<td class="address-1"><span id="63333"></span>F765</td>
<td class="instruction">LD A,($9649)</td>
<td class="comment-1" rowspan="1">Get the current room (<a href="38473.html">9649</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="63336"></span>F768</td>
<td class="instruction">CP $06</td>
<td class="comment-1" rowspan="1">Is it 06?</td>
</tr>
<tr>
<td class="address-1"><span id="63338"></span>F76A</td>
<td class="instruction">JR NZ,$F771</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="63340"></span>F76C</td>
<td class="instruction">SET 5,(IX+$00)</td>
<td class="comment-1" rowspan="2">Set the wall as cleared and return.</td>
</tr>
<tr>
<td class="address-1"><span id="63344"></span>F770</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="address-2"><span id="63345"></span>F771</td>
<td class="instruction">CP $0B</td>
<td class="comment-1" rowspan="1">Is this room 00B?</td>
</tr>
<tr>
<td class="address-1"><span id="63347"></span>F773</td>
<td class="instruction">JR NZ,$F77A</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="63349"></span>F775</td>
<td class="instruction">SET 4,(IX+$00)</td>
<td class="comment-1" rowspan="2">Set the wall as cleared and return.</td>
</tr>
<tr>
<td class="address-1"><span id="63353"></span>F779</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="address-2"><span id="63354"></span>F77A</td>
<td class="instruction">CP $0F</td>
<td class="comment-1" rowspan="1">Is this room 00F?</td>
</tr>
<tr>
<td class="address-1"><span id="63356"></span>F77C</td>
<td class="instruction">JR NZ,$F783</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="63358"></span>F77E</td>
<td class="instruction">SET 3,(IX+$00)</td>
<td class="comment-1" rowspan="2">Set the wall as cleared and return.</td>
</tr>
<tr>
<td class="address-1"><span id="63362"></span>F782</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="address-2"><span id="63363"></span>F783</td>
<td class="instruction">SET 2,(IX+$00)</td>
<td class="comment-1" rowspan="2">Must be room 0E. Set the wall as cleared and return.</td>
</tr>
<tr>
<td class="address-1"><span id="63367"></span>F787</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63229.html">F6FD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63258">Map</a></td>
<td class="next">
Next: <a href="63368.html">F788</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>