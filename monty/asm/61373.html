<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at EFBD</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61310.html">EF7E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61373">Map</a></td>
<td class="next">
Next: <a href="61505.html">F041</a>
</td>
</tr>
</table>
<div class="description">EFBD: Draw static UDGs on the start room</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="61310.html">EF7E</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to graphic IDs</td>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Character to print</td>
</tr>
<tr>
<td class="register">D</td>
<td class="register-desc">Y position</td>
</tr>
<tr>
<td class="register">E</td>
<td class="register-desc">X position</td>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Current row count</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="61373"></span>EFBD</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="4">Store all registers being used.</td>
</tr>
<tr>
<td class="address-1"><span id="61374"></span>EFBE</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address-1"><span id="61375"></span>EFBF</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address-1"><span id="61376"></span>EFC0</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="address-1"><span id="61377"></span>EFC1</td>
<td class="instruction">CP $7F</td>
<td class="comment-1" rowspan="2">If the character is 50 or above, move forward.</td>
</tr>
<tr>
<td class="address-1"><span id="61379"></span>EFC3</td>
<td class="instruction">JR NC,$F033</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61381"></span>
<div class="comments">
<div class="paragraph">
This is an ordinary character in the ROM.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="61381"></span>EFC5</td>
<td class="instruction">LD H,$00</td>
<td class="comment-1" rowspan="2">Put the character in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61383"></span>EFC7</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="61384"></span>EFC8</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="3">Multiply by 8 to get the correct offset.</td>
</tr>
<tr>
<td class="address-1"><span id="61385"></span>EFC9</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61386"></span>EFCA</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61387"></span>EFCB</td>
<td class="instruction">LD BC,$3C00</td>
<td class="comment-1" rowspan="1">Add the base address for the ROM character set.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61390"></span>
<div class="comments">
<div class="paragraph">
Now print the character.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="61390"></span>EFCE</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Add the offset to the base address.</td>
</tr>
<tr>
<td class="address-1"><span id="61391"></span>EFCF</td>
<td class="instruction">LD ($F047),HL</td>
<td class="comment-1" rowspan="1">Store the current address being printed.</td>
</tr>
<tr>
<td class="address-1"><span id="61394"></span>EFD2</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="3">Convert the Y position to a screen offset.</td>
</tr>
<tr>
<td class="address-1"><span id="61395"></span>EFD3</td>
<td class="instruction">SUB $17</td>
</tr>
<tr>
<td class="address-1"><span id="61397"></span>EFD5</td>
<td class="instruction">NEG</td>
</tr>
<tr>
<td class="address-1"><span id="61399"></span>EFD7</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="2">Put this in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61400"></span>EFD8</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="61402"></span>EFDA</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="3">Multiply by 8 to get the correct offset.</td>
</tr>
<tr>
<td class="address-1"><span id="61403"></span>EFDB</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61404"></span>EFDC</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61405"></span>EFDD</td>
<td class="instruction">LD BC,$0007</td>
<td class="comment-1" rowspan="2">Add an offset of 7 to point at the bottom of the graphic.</td>
</tr>
<tr>
<td class="address-1"><span id="61408"></span>EFE0</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="address-1"><span id="61409"></span>EFE1</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="4">Add the base address for the screen address buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="61410"></span>EFE2</td>
<td class="instruction">LD HL,$EA60</td>
</tr>
<tr>
<td class="address-1"><span id="61413"></span>EFE5</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="61414"></span>EFE6</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="61415"></span>EFE7</td>
<td class="instruction">LD ($F049),HL</td>
<td class="comment-1" rowspan="1">Store this.</td>
</tr>
<tr>
<td class="address-1"><span id="61418"></span>EFEA</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Print 8 rows.</td>
</tr>
<tr>
<td class="address-2"><span id="61420"></span>EFEC</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Put the actual screen address in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61421"></span>EFED</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="61422"></span>EFEE</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="61423"></span>EFEF</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="61424"></span>EFF0</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="61425"></span>EFF1</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Store it again.</td>
</tr>
<tr>
<td class="address-1"><span id="61426"></span>EFF2</td>
<td class="instruction">LD D,$00</td>
<td class="comment-1" rowspan="2">Add it to the screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="61428"></span>EFF4</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="61429"></span>EFF5</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Convert this into an address in the screen buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="61430"></span>EFF6</td>
<td class="instruction">CALL <a href="65167.html">$FE8F</a></td>
</tr>
<tr>
<td class="address-1"><span id="61433"></span>EFF9</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the byte.</td>
</tr>
<tr>
<td class="address-1"><span id="61434"></span>EFFA</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Move to the next data position and store it.</td>
</tr>
<tr>
<td class="address-1"><span id="61435"></span>EFFB</td>
<td class="instruction">LD ($F047),HL</td>
</tr>
<tr>
<td class="address-1"><span id="61438"></span>EFFE</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61439"></span>EFFF</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Set the byte.</td>
</tr>
<tr>
<td class="address-1"><span id="61440"></span>F000</td>
<td class="instruction">LD HL,($F049)</td>
<td class="comment-1" rowspan="4">Move the current screen address up a row.</td>
</tr>
<tr>
<td class="address-1"><span id="61443"></span>F003</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="61444"></span>F004</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="61445"></span>F005</td>
<td class="instruction">LD ($F049),HL</td>
</tr>
<tr>
<td class="address-1"><span id="61448"></span>F008</td>
<td class="instruction">DJNZ $EFEC</td>
<td class="comment-1" rowspan="1">Loop until all rows have been printed.</td>
</tr>
<tr>
<td class="address-1"><span id="61450"></span>F00A</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="2">Restore <span class="register">DE</span> and <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61451"></span>F00B</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address-1"><span id="61452"></span>F00C</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="4">Get an offset to the attribute buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="61453"></span>F00D</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="address-1"><span id="61454"></span>F00E</td>
<td class="instruction">LD DE,$0230</td>
</tr>
<tr>
<td class="address-1"><span id="61457"></span>F011</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="61458"></span>F012</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move up a row.</td>
</tr>
<tr>
<td class="address-1"><span id="61459"></span>F013</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61460"></span>F014</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Store it again.</td>
</tr>
<tr>
<td class="address-1"><span id="61461"></span>F015</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="4">Put the Y co-ordinate in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61462"></span>F016</td>
<td class="instruction">LD E,D</td>
</tr>
<tr>
<td class="address-1"><span id="61463"></span>F017</td>
<td class="instruction">LD D,$00</td>
</tr>
<tr>
<td class="address-1"><span id="61465"></span>F019</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61466"></span>F01A</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="3">Multiply 2^5 times ie: 32 to get an appropriate address.</td>
</tr>
<tr>
<td class="address-2"><span id="61468"></span>F01C</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61469"></span>F01D</td>
<td class="instruction">DJNZ $F01C</td>
</tr>
<tr>
<td class="address-1"><span id="61471"></span>F01F</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Store <span class="register">DE</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61472"></span>F020</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="3">Add the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="61473"></span>F021</td>
<td class="instruction">LD D,$00</td>
</tr>
<tr>
<td class="address-1"><span id="61475"></span>F023</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="61476"></span>F024</td>
<td class="instruction">LD DE,$CF54</td>
<td class="comment-1" rowspan="2">Add the base address of the attribute buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="61479"></span>F027</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="61480"></span>F028</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61481"></span>F029</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="4">Copy the graphic data.</td>
</tr>
<tr>
<td class="address-1"><span id="61482"></span>F02A</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="61483"></span>F02B</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61484"></span>F02C</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="61485"></span>F02D</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="61486"></span>F02E</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move to the next row.</td>
</tr>
<tr>
<td class="address-1"><span id="61487"></span>F02F</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="4">Restore all registers and return.</td>
</tr>
<tr>
<td class="address-1"><span id="61488"></span>F030</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="address-1"><span id="61489"></span>F031</td>
<td class="instruction">POP AF</td>
</tr>
<tr>
<td class="address-1"><span id="61490"></span>F032</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61491"></span>
<div class="comments">
<div class="paragraph">
This is a custom character.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="61491"></span>F033</td>
<td class="instruction">SUB $80</td>
<td class="comment-1" rowspan="1">Subtract 80 to get the real value.</td>
</tr>
<tr>
<td class="address-1"><span id="61493"></span>F035</td>
<td class="instruction">LD H,$00</td>
<td class="comment-1" rowspan="2">Put this in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="61495"></span>F037</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="61496"></span>F038</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="3">Multiply by 8 to get an offset in the screen buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="61497"></span>F039</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61498"></span>F03A</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="61499"></span>F03B</td>
<td class="instruction">LD BC,($F043)</td>
<td class="comment-1" rowspan="1">Get the start of the graphics.</td>
</tr>
<tr>
<td class="address-1"><span id="61503"></span>F03F</td>
<td class="instruction">JR $EFCE</td>
<td class="comment-1" rowspan="1">Print the character.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61310.html">EF7E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61373">Map</a></td>
<td class="next">
Next: <a href="61505.html">F041</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>