<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at 8D2E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="36111.html">8D0F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#36142">Map</a></td>
<td class="next">
Next: <a href="36178.html">8D52</a>
</td>
</tr>
</table>
<div class="description">8D2E: Update the movement tables (down)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="35901.html">8C3D</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Attribute in the current position</td>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Pointer to movement table  (<a href="36180.html">8D54</a>)</td>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Number of rows</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="36142"></span>8D2E</td>
<td class="instruction">LD DE,$C51A</td>
<td class="comment-1" rowspan="1">Point to the start of the movement attributes table (<a href="50458.html">C51A</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="36145"></span>8D31</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Remember <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="36146"></span>8D32</td>
<td class="instruction">LD B,$04</td>
<td class="comment-1" rowspan="1">Count four types.</td>
</tr>
<tr>
<td class="address-1"><span id="36148"></span>8D34</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="3">Is the current attribute this one?</td>
</tr>
<tr>
<td class="address-1"><span id="36149"></span>8D35</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-2"><span id="36150"></span>8D36</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="36151"></span>8D37</td>
<td class="instruction">JR Z,$8D50</td>
<td class="comment-1" rowspan="1">If so, found the attribute we want.</td>
</tr>
<tr>
<td class="address-1"><span id="36153"></span>8D39</td>
<td class="instruction">INC (IY+$00)</td>
<td class="comment-1" rowspan="1">Increment the type of attribute looked for.</td>
</tr>
<tr>
<td class="address-1"><span id="36156"></span>8D3C</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next attribute.</td>
</tr>
<tr>
<td class="address-1"><span id="36157"></span>8D3D</td>
<td class="instruction">DJNZ $8D36</td>
<td class="comment-1" rowspan="1">Repeat for the next four types.</td>
</tr>
<tr>
<td class="address-1"><span id="36159"></span>8D3F</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> to the start of the table.</td>
</tr>
<tr>
<td class="address-1"><span id="36160"></span>8D40</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="36161"></span>8D41</td>
<td class="instruction">LD (IY+$00),$00</td>
<td class="comment-1" rowspan="1">Initialise to no movement.</td>
</tr>
<tr>
<td class="address-1"><span id="36165"></span>8D45</td>
<td class="instruction">LD DE,$0020</td>
<td class="comment-1" rowspan="2">Move forward a row.</td>
</tr>
<tr>
<td class="address-1"><span id="36168"></span>8D48</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="36169"></span>8D49</td>
<td class="instruction">DJNZ $8D2E</td>
<td class="comment-1" rowspan="1">Repeat until all rows have been checked.</td>
</tr>
<tr>
<td class="address-1"><span id="36171"></span>8D4B</td>
<td class="instruction">LD (IY+$00),$04</td>
<td class="comment-1" rowspan="2">Mark this as empty space and return. } We've found a matching attribute and have set it. This entry point is used by the routine at <a href="36111.html">8D0F</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="36175"></span>8D4F</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="address-2"><span id="36176"></span>8D50</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="2">Tidy up the stack and return.</td>
</tr>
<tr>
<td class="address-1"><span id="36177"></span>8D51</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="36111.html">8D0F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#36142">Map</a></td>
<td class="next">
Next: <a href="36178.html">8D52</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>