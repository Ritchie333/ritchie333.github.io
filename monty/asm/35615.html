<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at 8B1F</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="35596.html">8B0C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#35615">Map</a></td>
<td class="next">
Next: <a href="35728.html">8B90</a>
</td>
</tr>
</table>
<div class="description">8B1F: Update Monty and act on room flags</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="35284.html">89D4</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">Pointer to room flags (<a href="36178.html">8D52</a>).</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="35615"></span>8B1F</td>
<td class="instruction">LD A,($5C7C)</td>
<td class="comment-1" rowspan="3">Take 2 off the current Y position.</td>
</tr>
<tr>
<td class="address-1"><span id="35618"></span>8B22</td>
<td class="instruction">SUB $02</td>
</tr>
<tr>
<td class="address-1"><span id="35620"></span>8B24</td>
<td class="instruction">LD ($5C7C),A</td>
</tr>
<tr>
<td class="address-1"><span id="35623"></span>8B27</td>
<td class="instruction">LD HL,$8D58</td>
<td class="comment-1" rowspan="2">Increment the distance fallen (<a href="36184.html">8D58</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="35626"></span>8B2A</td>
<td class="instruction">INC (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="35627"></span>8B2B</td>
<td class="instruction">LD A,($5C7C)</td>
<td class="comment-1" rowspan="2">Put the old Y position in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="35630"></span>8B2E</td>
<td class="instruction">ADD A,$02</td>
</tr>
<tr>
<td class="address-1"><span id="35632"></span>8B30</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Increment the distance fallen.</td>
</tr>
<tr>
<td class="address-1"><span id="35633"></span>8B31</td>
<td class="instruction">CALL <a href="33874.html">$8452</a></td>
<td class="comment-1" rowspan="1">Redraw Monty. Control continues to <a href="35615.html#35636">8B34</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35636"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="35284.html#35338">8A0A</a> and <a href="35427.html">8A63</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="35636"></span>8B34</td>
<td class="instruction">CALL <a href="35728.html">$8B90</a></td>
<td class="comment-1" rowspan="1">Check Monty's current movement.</td>
</tr>
<tr>
<td class="address-1"><span id="35639"></span>8B37</td>
<td class="instruction">LD HL,$5C7C</td>
<td class="comment-1" rowspan="1">Get the current position in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="35642"></span>8B3A</td>
<td class="instruction">BIT 1,(IX+$00)</td>
<td class="comment-1" rowspan="1">Is Monty jumping?</td>
</tr>
<tr>
<td class="address-1"><span id="35646"></span>8B3E</td>
<td class="instruction">JR NZ,$8B46</td>
<td class="comment-1" rowspan="1">Move forward if so.</td>
</tr>
<tr>
<td class="address-1"><span id="35648"></span>8B40</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="4">Align Monty with a pixel boundary.</td>
</tr>
<tr>
<td class="address-1"><span id="35650"></span>8B42</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="35651"></span>8B43</td>
<td class="instruction">RES 0,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="35653"></span>8B45</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35654"></span>
<div class="comments">
<div class="paragraph">
Check that Monty can move in all directions, and block movement that is not possible.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="35654"></span>8B46</td>
<td class="instruction">LD A,($8D7E)</td>
<td class="comment-1" rowspan="1">Get the temporary Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="35657"></span>8B49</td>
<td class="instruction">BIT 7,(IX+$00)</td>
<td class="comment-1" rowspan="1">Can Monty move up?</td>
</tr>
<tr>
<td class="address-1"><span id="35661"></span>8B4D</td>
<td class="instruction">JR Z,$8B55</td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="35663"></span>8B4F</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Is the current co-ordinate out of bounds?</td>
</tr>
<tr>
<td class="address-1"><span id="35664"></span>8B50</td>
<td class="instruction">JR NC,$8B55</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35666"></span>8B52</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">Re-align Monty on the appropriate boundary and jump forward.</td>
</tr>
<tr>
<td class="address-1"><span id="35667"></span>8B53</td>
<td class="instruction">JR $8B5F</td>
</tr>
<tr>
<td class="address-2"><span id="35669"></span>8B55</td>
<td class="instruction">BIT 6,(IX+$00)</td>
<td class="comment-1" rowspan="1">Can Monty move down?</td>
</tr>
<tr>
<td class="address-1"><span id="35673"></span>8B59</td>
<td class="instruction">JR Z,$8B5F</td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="35675"></span>8B5B</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Is the current co-ordinate out of bounds?</td>
</tr>
<tr>
<td class="address-1"><span id="35676"></span>8B5C</td>
<td class="instruction">JR C,$8B5F</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35678"></span>8B5E</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Re-align Monty on the appropriate boundary.</td>
</tr>
<tr>
<td class="address-2"><span id="35679"></span>8B5F</td>
<td class="instruction">LD HL,$5C7B</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at Monty's co-ordinates.</td>
</tr>
<tr>
<td class="address-1"><span id="35682"></span>8B62</td>
<td class="instruction">LD A,($8D7D)</td>
<td class="comment-1" rowspan="1">Get the temporary X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="35685"></span>8B65</td>
<td class="instruction">BIT 5,(IX+$00)</td>
<td class="comment-1" rowspan="1">Can Monty move left?</td>
</tr>
<tr>
<td class="address-1"><span id="35689"></span>8B69</td>
<td class="instruction">JR Z,$8B71</td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="35691"></span>8B6B</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Is the current co-ordinate out of bounds?</td>
</tr>
<tr>
<td class="address-1"><span id="35692"></span>8B6C</td>
<td class="instruction">JR C,$8B71</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35694"></span>8B6E</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">Re-align Monty on the appropriate boundary and jump forward.</td>
</tr>
<tr>
<td class="address-1"><span id="35695"></span>8B6F</td>
<td class="instruction">JR $8B7B</td>
</tr>
<tr>
<td class="address-2"><span id="35697"></span>8B71</td>
<td class="instruction">BIT 4,(IX+$00)</td>
<td class="comment-1" rowspan="1">Can Monty move right?</td>
</tr>
<tr>
<td class="address-1"><span id="35701"></span>8B75</td>
<td class="instruction">JR Z,$8B7B</td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="35703"></span>8B77</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Is the current co-ordinate out of bounds?</td>
</tr>
<tr>
<td class="address-1"><span id="35704"></span>8B78</td>
<td class="instruction">JR NC,$8B7B</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35706"></span>8B7A</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Re-align Monty on the appropriate boundary.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35707"></span>
<div class="comments">
<div class="paragraph">
Redraw Monty in the new screen position.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="35707"></span>8B7B</td>
<td class="instruction">LD HL,($5C7B)</td>
<td class="comment-1" rowspan="1">Get the screen position.</td>
</tr>
<tr>
<td class="address-1"><span id="35710"></span>8B7E</td>
<td class="instruction">LD ($ECDE),HL</td>
<td class="comment-1" rowspan="1">Set this for the graphic to print.</td>
</tr>
<tr>
<td class="address-1"><span id="35713"></span>8B81</td>
<td class="instruction">LD A,$04</td>
<td class="comment-1" rowspan="2">Height is 4.</td>
</tr>
<tr>
<td class="address-1"><span id="35715"></span>8B83</td>
<td class="instruction">LD ($832E),A</td>
</tr>
<tr>
<td class="address-1"><span id="35718"></span>8B86</td>
<td class="instruction">LD HL,($848C)</td>
<td class="comment-1" rowspan="1">Get the pointer to the sprite data.</td>
</tr>
<tr>
<td class="address-1"><span id="35721"></span>8B89</td>
<td class="instruction">LD ($ECE0),HL</td>
<td class="comment-1" rowspan="1">Set this to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="35724"></span>8B8C</td>
<td class="instruction">CALL <a href="60384.html">$EBE0</a></td>
<td class="comment-1" rowspan="2">Draw the graphic and return.</td>
</tr>
<tr>
<td class="address-1"><span id="35727"></span>8B8F</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="35596.html">8B0C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#35615">Map</a></td>
<td class="next">
Next: <a href="35728.html">8B90</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>