<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at 8452</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="33717.html">83B5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#33874">Map</a></td>
<td class="next">
Next: <a href="33932.html">848C</a>
</td>
</tr>
</table>
<div class="description">8452: Redraw Monty after jumping or falling</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="35427.html">8A63</a> and <a href="35615.html">8B1F</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Current Y co-ordinate</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="33874"></span>8452</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="3">Double the Y co-ordinate to get a word offset.</td>
</tr>
<tr>
<td class="address-1"><span id="33875"></span>8453</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="33877"></span>8455</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="33878"></span>8456</td>
<td class="instruction">LD DE,$EA60</td>
<td class="comment-1" rowspan="3">Get the appropriate pointer to a screen offset and store it in <a href="33945.html">8499</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="33881"></span>8459</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="33882"></span>845A</td>
<td class="instruction">LD ($8499),HL</td>
</tr>
<tr>
<td class="address-1"><span id="33885"></span>845D</td>
<td class="instruction">LD B,$02</td>
<td class="comment-1" rowspan="1">Draw 2 rows.</td>
</tr>
<tr>
<td class="address-2"><span id="33887"></span>845F</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Put the actual screen address in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="33888"></span>8460</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="33889"></span>8461</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="33890"></span>8462</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="33891"></span>8463</td>
<td class="instruction">LD D,$00</td>
<td class="comment-1" rowspan="6">Store the top 5 bits of the X co-ordinate in <span class="register">DE</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="33893"></span>8465</td>
<td class="instruction">LD A,($5C7B)</td>
</tr>
<tr>
<td class="address-1"><span id="33896"></span>8468</td>
<td class="instruction">SRL A</td>
</tr>
<tr>
<td class="address-1"><span id="33898"></span>846A</td>
<td class="instruction">SRL A</td>
</tr>
<tr>
<td class="address-1"><span id="33900"></span>846C</td>
<td class="instruction">SRL A</td>
</tr>
<tr>
<td class="address-1"><span id="33902"></span>846E</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="33903"></span>846F</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1">Add this to get the actual screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="33904"></span>8470</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="3">Add a offset to give an address in the screen buffer at <a href="53856.html">D260</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="33905"></span>8471</td>
<td class="instruction">LD HL,$9260</td>
</tr>
<tr>
<td class="address-1"><span id="33908"></span>8474</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="33909"></span>8475</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the graphic data.</td>
</tr>
<tr>
<td class="address-1"><span id="33910"></span>8476</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Set it.</td>
</tr>
<tr>
<td class="address-1"><span id="33911"></span>8477</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="33912"></span>8478</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Move forward to the next cell.</td>
</tr>
<tr>
<td class="address-1"><span id="33913"></span>8479</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="address-1"><span id="33914"></span>847A</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Get the graphic data.</td>
</tr>
<tr>
<td class="address-1"><span id="33915"></span>847B</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="33916"></span>847C</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Set it.</td>
</tr>
<tr>
<td class="address-1"><span id="33917"></span>847D</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="33918"></span>847E</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Move forward to the next cell.</td>
</tr>
<tr>
<td class="address-1"><span id="33919"></span>847F</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="address-1"><span id="33920"></span>8480</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Get the graphic data.</td>
</tr>
<tr>
<td class="address-1"><span id="33921"></span>8481</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="33922"></span>8482</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="2">Set it.</td>
</tr>
<tr>
<td class="address-1"><span id="33923"></span>8483</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="33924"></span>8484</td>
<td class="instruction">LD HL,($8499)</td>
<td class="comment-1" rowspan="1">Get the screen offset.</td>
</tr>
<tr>
<td class="address-1"><span id="33927"></span>8487</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="2">Move up an entry.</td>
</tr>
<tr>
<td class="address-1"><span id="33928"></span>8488</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="33929"></span>8489</td>
<td class="instruction">DJNZ $845F</td>
<td class="comment-1" rowspan="2">Loop until both rows have been drawn. }Ã¥</td>
</tr>
<tr>
<td class="address-1"><span id="33931"></span>848B</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="33717.html">83B5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#33874">Map</a></td>
<td class="next">
Next: <a href="33932.html">848C</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>