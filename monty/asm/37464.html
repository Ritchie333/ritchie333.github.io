<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at 9258</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37416.html">9228</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37464">Map</a></td>
<td class="next">
Next: <a href="37502.html">927E</a>
</td>
</tr>
</table>
<div class="description">9258: See if Monty is touching some coal and can collect it</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="37724.html">935C</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Current Y position</td>
</tr>
<tr>
<td class="register">L</td>
<td class="register-desc">Current X position</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">On exit, returns the address in the coal attribute buffer that was checked.</td>
</tr>
<tr>
<td class="register">F</td>
<td class="register-desc">Resets the zero flag if there is coal here, otherwise sets it.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="37464"></span>9258</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="6">Divide the X co-ordinate by 8 and put it in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="37465"></span>9259</td>
<td class="instruction">AND $F8</td>
</tr>
<tr>
<td class="address-1"><span id="37467"></span>925B</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="37468"></span>925C</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="37469"></span>925D</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="37470"></span>925E</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="address-1"><span id="37471"></span>925F</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="6">Divide the Y co-ordinate by 8 and put it in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="37472"></span>9260</td>
<td class="instruction">AND $F8</td>
</tr>
<tr>
<td class="address-1"><span id="37474"></span>9262</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="37475"></span>9263</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="37476"></span>9264</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="37477"></span>9265</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="37478"></span>9266</td>
<td class="instruction">LD A,$18</td>
<td class="comment-1" rowspan="4">Flip the Y co-ordinate to be the right way round for a screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="37480"></span>9268</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="address-1"><span id="37481"></span>9269</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="37482"></span>926A</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="37483"></span>926B</td>
<td class="instruction">LD L,B</td>
<td class="comment-1" rowspan="7">Convert this into a screen offset.</td>
</tr>
<tr>
<td class="address-1"><span id="37484"></span>926C</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="37486"></span>926E</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="37487"></span>926F</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="37488"></span>9270</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="37489"></span>9271</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="37490"></span>9272</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="37491"></span>9273</td>
<td class="instruction">LD D,$00</td>
<td class="comment-1" rowspan="3">Add the column to the screen offset.</td>
</tr>
<tr>
<td class="address-1"><span id="37493"></span>9275</td>
<td class="instruction">LD E,C</td>
</tr>
<tr>
<td class="address-1"><span id="37494"></span>9276</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="37495"></span>9277</td>
<td class="instruction">LD DE,$CF54</td>
<td class="comment-1" rowspan="2">Add the base position of the coal attributes (<a href="53076.html">CF54</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="37498"></span>927A</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="37499"></span>927B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="3">Reset the zero flag if there is coal at this position and return.</td>
</tr>
<tr>
<td class="address-1"><span id="37500"></span>927C</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="37501"></span>927D</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37416.html">9228</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37464">Map</a></td>
<td class="next">
Next: <a href="37502.html">927E</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>