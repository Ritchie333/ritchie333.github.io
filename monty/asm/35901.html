<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at 8C3D</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="35728.html">8B90</a>
</td>
<td class="up">Up: <a href="../maps/all.html#35901">Map</a></td>
<td class="next">
Next: <a href="36111.html">8D0F</a>
</td>
</tr>
</table>
<div class="description">8C3D: Check what attributes are around Monty</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="35728.html">8B90</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="35901"></span>8C3D</td>
<td class="instruction">LD IY,$8D54</td>
<td class="comment-1" rowspan="1">Point <span class="register">IY</span> at the movement table at <a href="36180.html">8D54</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="35905"></span>8C41</td>
<td class="instruction">LD B,$02</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="35907"></span>8C43</td>
<td class="instruction">LD A,($5C7C)</td>
<td class="comment-1" rowspan="1">Get the Y co-ordinate (<a href="23676.html">5C7C</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="35910"></span>8C46</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Remember this in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="35911"></span>8C47</td>
<td class="instruction">LD A,$BF</td>
<td class="comment-1" rowspan="2">Invert the bottom 6 bits.</td>
</tr>
<tr>
<td class="address-1"><span id="35913"></span>8C49</td>
<td class="instruction">SUB C</td>
</tr>
<tr>
<td class="address-1"><span id="35914"></span>8C4A</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Remember this.</td>
</tr>
<tr>
<td class="address-1"><span id="35915"></span>8C4B</td>
<td class="instruction">AND $07</td>
<td class="comment-1" rowspan="1">Get the lowest 3 bits.</td>
</tr>
<tr>
<td class="address-1"><span id="35917"></span>8C4D</td>
<td class="instruction">JR Z,$8C51</td>
<td class="comment-1" rowspan="1">Jump forward if none are set.</td>
</tr>
<tr>
<td class="address-1"><span id="35919"></span>8C4F</td>
<td class="instruction">LD B,$03</td>
<td class="comment-1" rowspan="1">Otherwise default to 3.</td>
</tr>
<tr>
<td class="address-2"><span id="35921"></span>8C51</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="2">Set the Y offset (<a href="36187.html">8D5B</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="35922"></span>8C52</td>
<td class="instruction">LD ($8D5B),A</td>
</tr>
<tr>
<td class="address-1"><span id="35925"></span>8C55</td>
<td class="instruction">LD C,$02</td>
<td class="comment-1" rowspan="1">Default to 2.</td>
</tr>
<tr>
<td class="address-1"><span id="35927"></span>8C57</td>
<td class="instruction">LD A,($5C7B)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate (<a href="23676.html">5C7C</a>);</td>
</tr>
<tr>
<td class="address-1"><span id="35930"></span>8C5A</td>
<td class="instruction">AND $07</td>
<td class="comment-1" rowspan="1">Get the lowest 3 bits.</td>
</tr>
<tr>
<td class="address-1"><span id="35932"></span>8C5C</td>
<td class="instruction">JR Z,$8C60</td>
<td class="comment-1" rowspan="1">Jump foward if none are set.</td>
</tr>
<tr>
<td class="address-1"><span id="35934"></span>8C5E</td>
<td class="instruction">LD C,$03</td>
<td class="comment-1" rowspan="1">Otherwise default to 3.</td>
</tr>
<tr>
<td class="address-2"><span id="35936"></span>8C60</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="2">Set the X offset (<a href="36188.html">8D5C</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="35937"></span>8C61</td>
<td class="instruction">LD ($8D5C),A</td>
</tr>
<tr>
<td class="address-1"><span id="35940"></span>8C64</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="35941"></span>8C65</td>
<td class="instruction">AND $F8</td>
<td class="comment-1" rowspan="5">Shift the top 5 bits down and store in the Y co-ordinate (<a href="36190.html">8D5E</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="35943"></span>8C67</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="35944"></span>8C68</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="35945"></span>8C69</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="35946"></span>8C6A</td>
<td class="instruction">LD ($8D5E),A</td>
</tr>
<tr>
<td class="address-1"><span id="35949"></span>8C6D</td>
<td class="instruction">LD A,($5C7B)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="35952"></span>8C70</td>
<td class="instruction">AND $F8</td>
<td class="comment-1" rowspan="5">Shift the top 5 bits down and store in the X co-ordinate  (<a href="36189.html">8D5D</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="35954"></span>8C72</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="35955"></span>8C73</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="35956"></span>8C74</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="35957"></span>8C75</td>
<td class="instruction">LD ($8D5D),A</td>
</tr>
<tr>
<td class="address-1"><span id="35960"></span>8C78</td>
<td class="instruction">LD A,($8D5E)</td>
<td class="comment-1" rowspan="1">Get the Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="35963"></span>8C7B</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="7">Scale it up to a screen address.</td>
</tr>
<tr>
<td class="address-1"><span id="35964"></span>8C7C</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="address-1"><span id="35966"></span>8C7E</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="35967"></span>8C7F</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="35968"></span>8C80</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="35969"></span>8C81</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="35970"></span>8C82</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="address-1"><span id="35971"></span>8C83</td>
<td class="instruction">LD A,($8D5D)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="35974"></span>8C86</td>
<td class="instruction">LD D,$00</td>
<td class="comment-1" rowspan="3">Add this to get the desired offset.</td>
</tr>
<tr>
<td class="address-1"><span id="35976"></span>8C88</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="35977"></span>8C89</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="35978"></span>8C8A</td>
<td class="instruction">LD DE,$5800</td>
<td class="comment-1" rowspan="2">Add the base address to get an attribute on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="35981"></span>8C8D</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="35982"></span>8C8E</td>
<td class="instruction">LD ($8D59),HL</td>
<td class="comment-1" rowspan="1">Store this attribute.</td>
</tr>
<tr>
<td class="address-1"><span id="35985"></span>8C91</td>
<td class="instruction">LD A,($8D5C)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate for the offset.</td>
</tr>
<tr>
<td class="address-1"><span id="35988"></span>8C94</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Store this in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="35989"></span>8C95</td>
<td class="instruction">LD (IY+$00),$00</td>
<td class="comment-1" rowspan="1">Default to no movement in this direction.</td>
</tr>
<tr>
<td class="address-1"><span id="35993"></span>8C99</td>
<td class="instruction">PUSH IY</td>
<td class="comment-1" rowspan="1">Remember <span class="register">IY</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="35995"></span>8C9B</td>
<td class="instruction">CALL <a href="36111.html">$8D0F</a></td>
<td class="comment-1" rowspan="1">Check the movement tables across.</td>
</tr>
<tr>
<td class="address-1"><span id="35998"></span>8C9E</td>
<td class="instruction">LD HL,($8D59)</td>
<td class="comment-1" rowspan="7">Move back a row.</td>
</tr>
<tr>
<td class="address-1"><span id="36001"></span>8CA1</td>
<td class="instruction">LD DE,$0020</td>
</tr>
<tr>
<td class="address-1"><span id="36004"></span>8CA4</td>
<td class="instruction">LD A,($8D5B)</td>
</tr>
<tr>
<td class="address-1"><span id="36007"></span>8CA7</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="36008"></span>8CA8</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-2"><span id="36009"></span>8CA9</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="36010"></span>8CAA</td>
<td class="instruction">DJNZ $8CA9</td>
</tr>
<tr>
<td class="address-1"><span id="36012"></span>8CAC</td>
<td class="instruction">LD A,($8D5C)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate for the offset.</td>
</tr>
<tr>
<td class="address-1"><span id="36015"></span>8CAF</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Store this in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="36016"></span>8CB0</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1">Move to the next direction.</td>
</tr>
<tr>
<td class="address-1"><span id="36018"></span>8CB2</td>
<td class="instruction">LD (IY+$00),$00</td>
<td class="comment-1" rowspan="1">Default to no movement.</td>
</tr>
<tr>
<td class="address-1"><span id="36022"></span>8CB6</td>
<td class="instruction">CALL <a href="36111.html">$8D0F</a></td>
<td class="comment-1" rowspan="1">Check movement tables across.</td>
</tr>
<tr>
<td class="address-1"><span id="36025"></span>8CB9</td>
<td class="instruction">LD HL,($8D59)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36028"></span>8CBC</td>
<td class="instruction">LD A,($8D5B)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36031"></span>8CBF</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36032"></span>8CC0</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1">Move to the next direction.</td>
</tr>
<tr>
<td class="address-1"><span id="36034"></span>8CC2</td>
<td class="instruction">LD (IY+$00),$00</td>
<td class="comment-1" rowspan="1">Default to no movement.</td>
</tr>
<tr>
<td class="address-1"><span id="36038"></span>8CC6</td>
<td class="instruction">CALL <a href="36142.html">$8D2E</a></td>
<td class="comment-1" rowspan="1">Check movement tables down.</td>
</tr>
<tr>
<td class="address-1"><span id="36041"></span>8CC9</td>
<td class="instruction">LD HL,($8D59)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36044"></span>8CCC</td>
<td class="instruction">LD A,($8D5C)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36047"></span>8CCF</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36048"></span>8CD0</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="36049"></span>8CD1</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36050"></span>8CD2</td>
<td class="instruction">DJNZ $8CD1</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36052"></span>8CD4</td>
<td class="instruction">LD A,($8D5B)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36055"></span>8CD7</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="36056"></span>8CD8</td>
<td class="instruction">INC IY</td>
<td class="comment-1" rowspan="1">Move to the next direction.</td>
</tr>
<tr>
<td class="address-1"><span id="36058"></span>8CDA</td>
<td class="instruction">LD (IY+$00),$00</td>
<td class="comment-1" rowspan="1">Default to no movement.</td>
</tr>
<tr>
<td class="address-1"><span id="36062"></span>8CDE</td>
<td class="instruction">CALL <a href="36142.html">$8D2E</a></td>
<td class="comment-1" rowspan="1">Check movement tables down.</td>
</tr>
<tr>
<td class="address-1"><span id="36065"></span>8CE1</td>
<td class="instruction">POP IY</td>
<td class="comment-1" rowspan="1">Restore <span class="register">IY</span> to the base position.</td>
</tr>
<tr>
<td class="address-1"><span id="36067"></span>8CE3</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="16">If any direction flag was set to 3, set it to 0 instead.</td>
</tr>
<tr>
<td class="address-1"><span id="36070"></span>8CE6</td>
<td class="instruction">CP $03</td>
</tr>
<tr>
<td class="address-1"><span id="36072"></span>8CE8</td>
<td class="instruction">JR NZ,$8CEE</td>
</tr>
<tr>
<td class="address-1"><span id="36074"></span>8CEA</td>
<td class="instruction">LD (IY+$00),$00</td>
</tr>
<tr>
<td class="address-2"><span id="36078"></span>8CEE</td>
<td class="instruction">LD A,(IY+$01)</td>
</tr>
<tr>
<td class="address-1"><span id="36081"></span>8CF1</td>
<td class="instruction">CP $03</td>
</tr>
<tr>
<td class="address-1"><span id="36083"></span>8CF3</td>
<td class="instruction">JR NZ,$8CF9</td>
</tr>
<tr>
<td class="address-1"><span id="36085"></span>8CF5</td>
<td class="instruction">LD (IY+$01),$00</td>
</tr>
<tr>
<td class="address-2"><span id="36089"></span>8CF9</td>
<td class="instruction">LD A,(IY+$02)</td>
</tr>
<tr>
<td class="address-1"><span id="36092"></span>8CFC</td>
<td class="instruction">CP $03</td>
</tr>
<tr>
<td class="address-1"><span id="36094"></span>8CFE</td>
<td class="instruction">JR NZ,$8D04</td>
</tr>
<tr>
<td class="address-1"><span id="36096"></span>8D00</td>
<td class="instruction">LD (IY+$02),$00</td>
</tr>
<tr>
<td class="address-2"><span id="36100"></span>8D04</td>
<td class="instruction">LD A,(IY+$03)</td>
</tr>
<tr>
<td class="address-1"><span id="36103"></span>8D07</td>
<td class="instruction">CP $03</td>
</tr>
<tr>
<td class="address-1"><span id="36105"></span>8D09</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="36106"></span>8D0A</td>
<td class="instruction">LD (IY+$03),$00</td>
</tr>
<tr>
<td class="address-1"><span id="36110"></span>8D0E</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="35728.html">8B90</a>
</td>
<td class="up">Up: <a href="../maps/all.html#35901">Map</a></td>
<td class="next">
Next: <a href="36111.html">8D0F</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>