<!DOCTYPE html>
<html>
<head>
<title>Wanted : Monty Mole: Routine at 8964</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="35171.html">8963</a>
</td>
<td class="up">Up: <a href="../maps/all.html#35172">Map</a></td>
<td class="next">
Next: <a href="35284.html">89D4</a>
</td>
</tr>
</table>
<div class="description">8964: Update a type 2 (single direction) nasty</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="34941.html">887D</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Status flag for this nasty.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="35172"></span>8964</td>
<td class="instruction">CP $03</td>
<td class="comment-1" rowspan="1">Is the nasty invisible?</td>
</tr>
<tr>
<td class="address-1"><span id="35174"></span>8966</td>
<td class="instruction">JP Z,<a href="34641.html#34903">$8857</a></td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="35177"></span>8969</td>
<td class="instruction">LD A,(IX+$10)</td>
<td class="comment-1" rowspan="2">Decrement the current distance.</td>
</tr>
<tr>
<td class="address-1"><span id="35180"></span>896C</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="35181"></span>896D</td>
<td class="instruction">JP NZ,<a href="34641.html#34658">$8762</a></td>
<td class="comment-1" rowspan="1">Jump if it is not zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="35184"></span>
<div class="comments">
<div class="paragraph">
The nasty needs to be redrawn.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="35184"></span>8970</td>
<td class="instruction">LD A,(IX+$0E)</td>
<td class="comment-1" rowspan="1">Get the width or height.</td>
</tr>
<tr>
<td class="address-1"><span id="35187"></span>8973</td>
<td class="instruction">LD (IX+$10),A</td>
<td class="comment-1" rowspan="1">Set this to the current distance travelled.</td>
</tr>
<tr>
<td class="address-1"><span id="35190"></span>8976</td>
<td class="instruction">LD (IX+$00),$03</td>
<td class="comment-1" rowspan="1">Make the nasty invisible in its current position.</td>
</tr>
<tr>
<td class="address-1"><span id="35194"></span>897A</td>
<td class="instruction">LD A,(IX+$0A)</td>
<td class="comment-1" rowspan="1">Get the index.</td>
</tr>
<tr>
<td class="address-1"><span id="35197"></span>897D</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="10">Convert this to an offset to the nasty table.</td>
</tr>
<tr>
<td class="address-1"><span id="35198"></span>897E</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="35199"></span>897F</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="35200"></span>8980</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="35201"></span>8981</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="35202"></span>8982</td>
<td class="instruction">ADD A,B</td>
</tr>
<tr>
<td class="address-1"><span id="35203"></span>8983</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="35204"></span>8984</td>
<td class="instruction">LD D,$00</td>
</tr>
<tr>
<td class="address-1"><span id="35206"></span>8986</td>
<td class="instruction">LD HL,$C596</td>
</tr>
<tr>
<td class="address-1"><span id="35209"></span>8989</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="35210"></span>898A</td>
<td class="instruction">LD A,$02</td>
<td class="comment-1" rowspan="2">Set that this is a unidirectional nasty (should already be set).</td>
</tr>
<tr>
<td class="address-1"><span id="35212"></span>898C</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="35213"></span>898D</td>
<td class="instruction">LD B,(IX+$0E)</td>
<td class="comment-1" rowspan="7">Multiply the distance covered by the speed to denote the offset to move back to the initial position and store it in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="35216"></span>8990</td>
<td class="instruction">DEC B</td>
</tr>
<tr>
<td class="address-1"><span id="35217"></span>8991</td>
<td class="instruction">LD C,(IX+$11)</td>
</tr>
<tr>
<td class="address-1"><span id="35220"></span>8994</td>
<td class="instruction">XOR A</td>
</tr>
<tr>
<td class="address-2"><span id="35221"></span>8995</td>
<td class="instruction">ADD A,C</td>
</tr>
<tr>
<td class="address-1"><span id="35222"></span>8996</td>
<td class="instruction">DJNZ $8995</td>
</tr>
<tr>
<td class="address-1"><span id="35224"></span>8998</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="35225"></span>8999</td>
<td class="instruction">LD A,(IX+$0B)</td>
<td class="comment-1" rowspan="1">Get the current direction.</td>
</tr>
<tr>
<td class="address-1"><span id="35228"></span>899C</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is the nasty moving up?</td>
</tr>
<tr>
<td class="address-1"><span id="35229"></span>899D</td>
<td class="instruction">JR NZ,$89A9</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35231"></span>899F</td>
<td class="instruction">LD A,(IX+$0D)</td>
<td class="comment-1" rowspan="4">Move the Y co-ordinate down by the appropriate distance and move forward.</td>
</tr>
<tr>
<td class="address-1"><span id="35234"></span>89A2</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="address-1"><span id="35235"></span>89A3</td>
<td class="instruction">LD (IX+$0D),A</td>
</tr>
<tr>
<td class="address-1"><span id="35238"></span>89A6</td>
<td class="instruction">JP <a href="34641.html#34903">$8857</a></td>
</tr>
<tr>
<td class="address-2"><span id="35241"></span>89A9</td>
<td class="instruction">CP $01</td>
<td class="comment-1" rowspan="1">Is the nasty moving up?</td>
</tr>
<tr>
<td class="address-1"><span id="35243"></span>89AB</td>
<td class="instruction">JR NZ,$89B7</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35245"></span>89AD</td>
<td class="instruction">LD A,(IX+$0D)</td>
<td class="comment-1" rowspan="4">Move the Y co-ordinate up by the appropriate distance and move forward.</td>
</tr>
<tr>
<td class="address-1"><span id="35248"></span>89B0</td>
<td class="instruction">ADD A,B</td>
</tr>
<tr>
<td class="address-1"><span id="35249"></span>89B1</td>
<td class="instruction">LD (IX+$0D),A</td>
</tr>
<tr>
<td class="address-1"><span id="35252"></span>89B4</td>
<td class="instruction">JP <a href="34641.html#34903">$8857</a></td>
</tr>
<tr>
<td class="address-2"><span id="35255"></span>89B7</td>
<td class="instruction">CP $02</td>
<td class="comment-1" rowspan="1">Is the nasty moving left?</td>
</tr>
<tr>
<td class="address-1"><span id="35257"></span>89B9</td>
<td class="instruction">JR NZ,$89C5</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35259"></span>89BB</td>
<td class="instruction">LD A,(IX+$0C)</td>
<td class="comment-1" rowspan="4">Move the X co-ordinate right by the appropriate distance and move forward.</td>
</tr>
<tr>
<td class="address-1"><span id="35262"></span>89BE</td>
<td class="instruction">ADD A,B</td>
</tr>
<tr>
<td class="address-1"><span id="35263"></span>89BF</td>
<td class="instruction">LD (IX+$0C),A</td>
</tr>
<tr>
<td class="address-1"><span id="35266"></span>89C2</td>
<td class="instruction">JP <a href="34641.html#34903">$8857</a></td>
</tr>
<tr>
<td class="address-2"><span id="35269"></span>89C5</td>
<td class="instruction">CP $03</td>
<td class="comment-1" rowspan="1">Is the nasty moving right?</td>
</tr>
<tr>
<td class="address-1"><span id="35271"></span>89C7</td>
<td class="instruction">JP NZ,<a href="34641.html#34903">$8857</a></td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="35274"></span>89CA</td>
<td class="instruction">LD A,(IX+$0C)</td>
<td class="comment-1" rowspan="4">Move the X co-ordinate left by the appropriate distance and move forward.</td>
</tr>
<tr>
<td class="address-1"><span id="35277"></span>89CD</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="address-1"><span id="35278"></span>89CE</td>
<td class="instruction">LD (IX+$0C),A</td>
</tr>
<tr>
<td class="address-1"><span id="35281"></span>89D1</td>
<td class="instruction">JP <a href="34641.html#34903">$8857</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="35171.html">8963</a>
</td>
<td class="up">Up: <a href="../maps/all.html#35172">Map</a></td>
<td class="next">
Next: <a href="35284.html">89D4</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Peter Harrap / Gremlin Graphics 1984. This dissassembly by Ritchie Swann 2018-2023.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>