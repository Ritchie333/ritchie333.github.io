<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F5F1</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62931.html">F5D3</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62961">Map</a></td>
<td class="next">
Next: <a href="63051.html">F64B</a>
</td>
</tr>
</table>
<div class="description">F5F1: Room logic : School Lane</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
First, draw the electricity wire.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62961"></span>F5F1</td>
<td class="instruction">LD HL,$5DE7</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> to the screen buffer. (<a href="23296.html">5B00</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="62964"></span>F5F4</td>
<td class="instruction">LD DE,$0020</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> to the amount to move forward by for each row.</td>
</tr>
<tr>
<td class="address-1"><span id="62967"></span>F5F7</td>
<td class="instruction">LD BC,School_Wire</td>
<td class="comment-1" rowspan="1">Set <span class="register">BC</span> to the data table. (<a href="62931.html">F5D3</a>)</td>
</tr>
<tr>
<td class="address-2"><span id="62970"></span>F5FA</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-1" rowspan="1">Reset all pixels on the first row.</td>
</tr>
<tr>
<td class="address-1"><span id="62972"></span>F5FC</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1">Move to the next row.</td>
</tr>
<tr>
<td class="address-1"><span id="62973"></span>F5FD</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-1" rowspan="1">Set all pixels.</td>
</tr>
<tr>
<td class="address-1"><span id="62975"></span>F5FF</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1">Move to the next row.</td>
</tr>
<tr>
<td class="address-1"><span id="62976"></span>F600</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-1" rowspan="1">Reset all pixels.</td>
</tr>
<tr>
<td class="address-1"><span id="62978"></span>F602</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="3">Move back up to the initial row.</td>
</tr>
<tr>
<td class="address-1"><span id="62979"></span>F603</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="62981"></span>F605</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="62983"></span>F607</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-1" rowspan="1">Get the next byte.</td>
</tr>
<tr>
<td class="address-1"><span id="62984"></span>F608</td>
<td class="instruction">INC BC</td>
<td class="comment-1" rowspan="1">Move to the next place in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="62985"></span>F609</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1">Is it an end marker?</td>
</tr>
<tr>
<td class="address-1"><span id="62987"></span>F60B</td>
<td class="instruction">JR Z,$F61D</td>
<td class="comment-1" rowspan="1">Jump foward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="62989"></span>F60D</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is the data 0?</td>
</tr>
<tr>
<td class="address-1"><span id="62990"></span>F60E</td>
<td class="instruction">JR Z,$F61A</td>
<td class="comment-1" rowspan="1">Jump forward if it isn't.</td>
</tr>
<tr>
<td class="address-1"><span id="62992"></span>F610</td>
<td class="instruction">CP $01</td>
<td class="comment-1" rowspan="1">Is the data 1?</td>
</tr>
<tr>
<td class="address-1"><span id="62994"></span>F612</td>
<td class="instruction">JR NZ,$F617</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="62996"></span>F614</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="2">Otherwise move to the next row.</td>
</tr>
<tr>
<td class="address-1"><span id="62997"></span>F615</td>
<td class="instruction">JR $F61A</td>
</tr>
<tr>
<td class="address-2"><span id="62999"></span>F617</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="2">Move up a row.</td>
</tr>
<tr>
<td class="address-1"><span id="63000"></span>F618</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="address-2"><span id="63002"></span>F61A</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Move to the next column and repeat.</td>
</tr>
<tr>
<td class="address-1"><span id="63003"></span>F61B</td>
<td class="instruction">JR $F5FA</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63005"></span>
<div class="comments">
<div class="paragraph">
Now set the main data for the room.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63005"></span>F61D</td>
<td class="instruction">LD A,$06</td>
<td class="comment-1" rowspan="2">Moving objects decrease endurance by 6.</td>
</tr>
<tr>
<td class="address-1"><span id="63007"></span>F61F</td>
<td class="instruction">LD (Endurance_Penalty),A</td>
</tr>
<tr>
<td class="address-1"><span id="63010"></span>F622</td>
<td class="instruction">LD IX,SchoolLane_Movement</td>
<td class="comment-1" rowspan="1">Point <span class="register">IX</span> at the movement table.</td>
</tr>
<tr>
<td class="address-1"><span id="63014"></span>F626</td>
<td class="instruction">LD B,$03</td>
<td class="comment-1" rowspan="1">3 lightning bolts to draw.</td>
</tr>
<tr>
<td class="address-2"><span id="63016"></span>F628</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Store <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63017"></span>F629</td>
<td class="instruction">LD A,$0D</td>
<td class="comment-1" rowspan="2">Is flag 0D (Asteroids game won) set?</td>
</tr>
<tr>
<td class="address-1"><span id="63019"></span>F62B</td>
<td class="instruction">CALL Get_Flag</td>
</tr>
<tr>
<td class="address-1"><span id="63022"></span>F62E</td>
<td class="instruction">LD BC,Generic_Bounds</td>
<td class="comment-1" rowspan="1">Point <span class="register">BC</span> at the first bounds table. (<a href="62922.html">F5CA</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="63025"></span>F631</td>
<td class="instruction">JR NZ,$F636</td>
<td class="comment-1" rowspan="1">If the flag is set, skip the next bit.</td>
</tr>
<tr>
<td class="address-1"><span id="63027"></span>F633</td>
<td class="instruction">LD BC,SchoolLane_Bounds</td>
<td class="comment-1" rowspan="1">Otherwise point <span class="register">BC</span> at the second bounds table. (<a href="62926.html">F5CE</a>)</td>
</tr>
<tr>
<td class="address-2"><span id="63030"></span>F636</td>
<td class="instruction">CALL Update_Next_Sprite</td>
<td class="comment-1" rowspan="1">Update moving objects.</td>
</tr>
<tr>
<td class="address-1"><span id="63033"></span>F639</td>
<td class="instruction">LD A,(Lightning_Frame_ID)</td>
<td class="comment-1" rowspan="1">Get the next object ID to print.</td>
</tr>
<tr>
<td class="address-1"><span id="63036"></span>F63C</td>
<td class="instruction">XOR $02</td>
<td class="comment-1" rowspan="1">Invert bit 2, so the ID alternates between 38 and 3A.</td>
</tr>
<tr>
<td class="address-1"><span id="63038"></span>F63E</td>
<td class="instruction">LD (Lightning_Frame_ID),A</td>
<td class="comment-1" rowspan="1">Set this for the next object ID.</td>
</tr>
<tr>
<td class="address-1"><span id="63041"></span>F641</td>
<td class="instruction">CALL Draw_Mask</td>
<td class="comment-1" rowspan="1">Draw moving objects.</td>
</tr>
<tr>
<td class="address-1"><span id="63044"></span>F644</td>
<td class="instruction">CALL Detect_Collision</td>
<td class="comment-1" rowspan="1">Check for collision detection.</td>
</tr>
<tr>
<td class="address-1"><span id="63047"></span>F647</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63048"></span>F648</td>
<td class="instruction">DJNZ $F628</td>
<td class="comment-1" rowspan="1">Loop while there are more lighting bolts to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="63050"></span>F64A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62931.html">F5D3</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62961">Map</a></td>
<td class="next">
Next: <a href="63051.html">F64B</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>