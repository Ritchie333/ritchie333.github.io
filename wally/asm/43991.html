<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at ABD7</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="43931.html">AB9B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43991">Map</a></td>
<td class="next">
Next: <a href="44038.html">AC06</a>
</td>
</tr>
</table>
<div class="description">ABD7: See if the 'in' key was pressed and set A to 1 if it was</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="44038.html">AC06</a>, <a href="60714.html">ED2A</a> and <a href="63802.html">F93A</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="43991"></span>ABD7</td>
<td class="instruction">LD A,($B2DB)</td>
<td class="comment-1" rowspan="1">Get the current control mechanism. (<a href="45787.html">B2DB</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="43994"></span>ABDA</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is it 0? (Keyboard)</td>
</tr>
<tr>
<td class="address-1"><span id="43995"></span>ABDB</td>
<td class="instruction">JR Z,$ABEA</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="43997"></span>ABDD</td>
<td class="instruction">CP $01</td>
<td class="comment-1" rowspan="1">Is it 1? (Kempston)</td>
</tr>
<tr>
<td class="address-1"><span id="43999"></span>ABDF</td>
<td class="instruction">JR NZ,$ABFC</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44001"></span>
<div class="comments">
<div class="paragraph">
Handle Kempston input.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="44001"></span>ABE1</td>
<td class="instruction">IN A,($1F)</td>
<td class="comment-1" rowspan="1">Read the Kempston interface.</td>
</tr>
<tr>
<td class="address-1"><span id="44003"></span>ABE3</td>
<td class="instruction">BIT 3,A</td>
<td class="comment-1" rowspan="1">Was "up" pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="44005"></span>ABE5</td>
<td class="instruction">JR Z,$AC04</td>
<td class="comment-1" rowspan="1">Jump to set "no input" if it wasn't.</td>
</tr>
<tr>
<td class="address-2"><span id="44007"></span>ABE7</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="1">Other set "in pressed" and return.</td>
</tr>
<tr>
<td class="address-1"><span id="44009"></span>ABE9</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44010"></span>
<div class="comments">
<div class="paragraph">
Handle keyboard input.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="44010"></span>ABEA</td>
<td class="instruction">LD A,$FD</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44012"></span>ABEC</td>
<td class="instruction">IN A,($FE)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44014"></span>ABEE</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44015"></span>ABEF</td>
<td class="instruction">LD A,$BF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44017"></span>ABF1</td>
<td class="instruction">IN A,($FE)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44019"></span>ABF3</td>
<td class="instruction">AND B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44020"></span>ABF4</td>
<td class="instruction">OR $E0</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44022"></span>ABF6</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44024"></span>ABF8</td>
<td class="instruction">JR NZ,$ABE7</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44026"></span>ABFA</td>
<td class="instruction">JR $AC04</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44028"></span>
<div class="comments">
<div class="paragraph">
Handle Sinclair input.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="44028"></span>ABFC</td>
<td class="instruction">LD A,$EF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44030"></span>ABFE</td>
<td class="instruction">IN A,($FE)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44032"></span>AC00</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="44034"></span>AC02</td>
<td class="instruction">JR Z,$ABE7</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="44036"></span>
<div class="comments">
<div class="paragraph">
'in' wasn't pressed, so reset the flag.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="44036"></span>AC04</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Set result as 0 and return.</td>
</tr>
<tr>
<td class="address-1"><span id="44037"></span>AC05</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="43931.html">AB9B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43991">Map</a></td>
<td class="next">
Next: <a href="44038.html">AC06</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>