<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F773</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Everyone's A Wally</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63302.html">F746</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63347">Map</a></td>
<td class="next">
Next: <a href="63454.html">F7DE</a>
</td>
</tr>
</table>
<div class="description">F773: Room logic : The School</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63347"></span>F773</td>
<td class="instruction">LD A,$02</td>
<td class="comment-1" rowspan="2">Moving objects decrease endurance by 2.</td>
</tr>
<tr>
<td class="address-1"><span id="63349"></span>F775</td>
<td class="instruction">LD ($F26E),A</td>
</tr>
<tr>
<td class="address-1"><span id="63352"></span>F778</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="1">Get the player's Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63355"></span>F77B</td>
<td class="instruction">CP $98</td>
<td class="comment-1" rowspan="1">Is the player on the floor?</td>
</tr>
<tr>
<td class="address-1"><span id="63357"></span>F77D</td>
<td class="instruction">JR NZ,$F78D</td>
<td class="comment-1" rowspan="1">Jump forward if they're not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63359"></span>
<div class="comments">
<div class="paragraph">
The player is on the floor.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63359"></span>F77F</td>
<td class="instruction">LD A,(IY+$05)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63362"></span>F782</td>
<td class="instruction">CP $28</td>
<td class="comment-1" rowspan="1">Is it greater than 28?</td>
</tr>
<tr>
<td class="address-1"><span id="63364"></span>F784</td>
<td class="instruction">JR C,$F78D</td>
<td class="comment-1" rowspan="1">Jump forward if so.</td>
</tr>
<tr>
<td class="address-1"><span id="63366"></span>F786</td>
<td class="instruction">CP $E6</td>
<td class="comment-1" rowspan="1">Is it less than E6?</td>
</tr>
<tr>
<td class="address-1"><span id="63368"></span>F788</td>
<td class="instruction">JR NC,$F78D</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="63370"></span>F78A</td>
<td class="instruction">CALL <a href="58153.html#58175">$E33F</a></td>
<td class="comment-1" rowspan="1">Otherwise, the player is standing on the spikes, so decrease endurance.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63373"></span>
<div class="comments">
<div class="paragraph">
Now draw the desks.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63373"></span>F78D</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="1">5 objects to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="63375"></span>F78F</td>
<td class="instruction">LD A,($F7DE)</td>
<td class="comment-1" rowspan="1">Get the next frame ID of the desk.</td>
</tr>
<tr>
<td class="address-1"><span id="63378"></span>F792</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment it.</td>
</tr>
<tr>
<td class="address-1"><span id="63379"></span>F793</td>
<td class="instruction">CP $5B</td>
<td class="comment-1" rowspan="3">If it goes higher than 5A set it back to 57.</td>
</tr>
<tr>
<td class="address-1"><span id="63381"></span>F795</td>
<td class="instruction">JR NZ,$F799</td>
</tr>
<tr>
<td class="address-1"><span id="63383"></span>F797</td>
<td class="instruction">LD A,$57</td>
</tr>
<tr>
<td class="address-2"><span id="63385"></span>F799</td>
<td class="instruction">LD ($F7DE),A</td>
<td class="comment-1" rowspan="1">Store the next frame ID.</td>
</tr>
<tr>
<td class="address-1"><span id="63388"></span>F79C</td>
<td class="instruction">LD HL,$F7DF</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next x co-ordinate to use.</td>
</tr>
<tr>
<td class="address-1"><span id="63391"></span>F79F</td>
<td class="instruction">LD D,$98</td>
<td class="comment-1" rowspan="1">Y co-ordinate is always 98.</td>
</tr>
<tr>
<td class="address-2"><span id="63393"></span>F7A1</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63394"></span>F7A2</td>
<td class="instruction">LD ($A838),DE</td>
<td class="comment-1" rowspan="1">Set the position to draw. (<a href="43064.html">A838</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="63398"></span>F7A6</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="63399"></span>F7A7</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Decrement the tick counter.</td>
</tr>
<tr>
<td class="address-1"><span id="63400"></span>F7A8</td>
<td class="instruction">JR NZ,$F7AC</td>
<td class="comment-1" rowspan="1">Jump forward if it's not zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63402"></span>
<div class="comments">
<div class="paragraph">
The tick counter has run to 0, does a desk need to be flipped?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63402"></span>F7AA</td>
<td class="instruction">LD (HL),$28</td>
<td class="comment-1" rowspan="1">Set the tick count back to 28.</td>
</tr>
<tr>
<td class="address-2"><span id="63404"></span>F7AC</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Put the tick count in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63405"></span>F7AD</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="63406"></span>F7AE</td>
<td class="instruction">CP $09</td>
<td class="comment-1" rowspan="1">Is the counter less than 9?</td>
</tr>
<tr>
<td class="address-1"><span id="63408"></span>F7B0</td>
<td class="instruction">JR NC,$F7D6</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63410"></span>
<div class="comments">
<div class="paragraph">
The desk needs flipping, check if dislodges the player.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63410"></span>F7B2</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="1">Get the player's y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63413"></span>F7B5</td>
<td class="instruction">CP $80</td>
<td class="comment-1" rowspan="1">Is it 80? (ie: on a desk)</td>
</tr>
<tr>
<td class="address-1"><span id="63415"></span>F7B7</td>
<td class="instruction">JR NZ,$F7D1</td>
<td class="comment-1" rowspan="1">Jump foward if it isn't.</td>
</tr>
<tr>
<td class="address-1"><span id="63417"></span>F7B9</td>
<td class="instruction">LD A,($A838)</td>
<td class="comment-1" rowspan="4">Is the player's x co-ordinate near this one?</td>
</tr>
<tr>
<td class="address-1"><span id="63420"></span>F7BC</td>
<td class="instruction">SUB (IY+$05)</td>
</tr>
<tr>
<td class="address-1"><span id="63423"></span>F7BF</td>
<td class="instruction">SUB $10</td>
</tr>
<tr>
<td class="address-1"><span id="63425"></span>F7C1</td>
<td class="instruction">CP $E0</td>
</tr>
<tr>
<td class="address-1"><span id="63427"></span>F7C3</td>
<td class="instruction">JR C,$F7D1</td>
<td class="comment-1" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63429"></span>
<div class="comments">
<div class="paragraph">
The desk opened while the player was on it. Dislodge them.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63429"></span>F7C5</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="3">Add 4 to the player's y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63432"></span>F7C8</td>
<td class="instruction">ADD A,$04</td>
</tr>
<tr>
<td class="address-1"><span id="63434"></span>F7CA</td>
<td class="instruction">LD (IY+$0A),A</td>
</tr>
<tr>
<td class="address-1"><span id="63437"></span>F7CD</td>
<td class="instruction">LD (IY+$37),$01</td>
<td class="comment-1" rowspan="1">Set the character in mid-air.</td>
</tr>
<tr>
<td class="address-2"><span id="63441"></span>F7D1</td>
<td class="instruction">LD A,($F7DE)</td>
<td class="comment-1" rowspan="1">Get the object ID to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="63444"></span>F7D4</td>
<td class="instruction">JR $F7D8</td>
<td class="comment-1" rowspan="1">Jump forward to draw it.</td>
</tr>
<tr>
<td class="address-2"><span id="63446"></span>F7D6</td>
<td class="instruction">LD A,$57</td>
<td class="comment-1" rowspan="1">Set the object ID as 57 - closed desk. (<a href="36440.html">8E58</a>)</td>
</tr>
<tr>
<td class="address-2"><span id="63448"></span>F7D8</td>
<td class="instruction">CALL <a href="43069.html">$A83D</a></td>
<td class="comment-1" rowspan="1">Draw the object</td>
</tr>
<tr>
<td class="address-1"><span id="63451"></span>F7DB</td>
<td class="instruction">DJNZ $F7A1</td>
<td class="comment-1" rowspan="1">Loop while there are more objects to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="63453"></span>F7DD</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Otherwise return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63302.html">F746</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63347">Map</a></td>
<td class="next">
Next: <a href="63454.html">F7DE</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>