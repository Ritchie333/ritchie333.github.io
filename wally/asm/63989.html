<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F9F5</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Everyone's A Wally</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63988.html">F9F4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63989">Map</a></td>
<td class="next">
Next: <a href="64231.html">FAE7</a>
</td>
</tr>
</table>
<div class="description">F9F5: Asteroids : Check for firing missile and animate accordingly</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="60919.html">EDF7</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63989"></span>F9F5</td>
<td class="instruction">LD IX,$F9F0</td>
<td class="comment-1" rowspan="1">Point <span class="register">IX</span> at the missile data.</td>
</tr>
<tr>
<td class="address-1"><span id="63993"></span>F9F9</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="2">Is a missile firing?</td>
</tr>
<tr>
<td class="address-1"><span id="63996"></span>F9FC</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address-1"><span id="63998"></span>F9FE</td>
<td class="instruction">JR NZ,$FA2A</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="64000"></span>FA00</td>
<td class="instruction">CALL <a href="45165.html">$B06D</a></td>
<td class="comment-1" rowspan="2">Was 'fire' pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="64003"></span>FA03</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="64004"></span>FA04</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if it wasn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64005"></span>
<div class="comments">
<div class="paragraph">
'Fire' was pressed.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="64005"></span>FA05</td>
<td class="instruction">LD A,(IY+$05)</td>
<td class="comment-1" rowspan="1">Get the x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="64008"></span>FA08</td>
<td class="instruction">LD ($F9F0),A</td>
<td class="comment-1" rowspan="1">Set this as the x co-ordinate of the missile.</td>
</tr>
<tr>
<td class="address-1"><span id="64011"></span>FA0B</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="1">Get the y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="64014"></span>FA0E</td>
<td class="instruction">LD ($F9F1),A</td>
<td class="comment-1" rowspan="1">Set this as the y co-ordinate of the missile.</td>
</tr>
<tr>
<td class="address-1"><span id="64017"></span>FA11</td>
<td class="instruction">CALL <a href="63908.html">$F9A4</a></td>
<td class="comment-1" rowspan="1">Get the change values for the current direction.</td>
</tr>
<tr>
<td class="address-1"><span id="64020"></span>FA14</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the change in x.</td>
</tr>
<tr>
<td class="address-1"><span id="64021"></span>FA15</td>
<td class="instruction">LD ($F9F2),A</td>
<td class="comment-1" rowspan="1">Set this for the missile.</td>
</tr>
<tr>
<td class="address-1"><span id="64024"></span>FA18</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the table.</td>
</tr>
<tr>
<td class="address-1"><span id="64025"></span>FA19</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the change in y.</td>
</tr>
<tr>
<td class="address-1"><span id="64026"></span>FA1A</td>
<td class="instruction">LD ($F9F3),A</td>
<td class="comment-1" rowspan="1">Set this for the missile.</td>
</tr>
<tr>
<td class="address-1"><span id="64029"></span>FA1D</td>
<td class="instruction">LD BC,$FF0A</td>
<td class="comment-1" rowspan="4">Play a "fire a missile" round.</td>
</tr>
<tr>
<td class="address-1"><span id="64032"></span>FA20</td>
<td class="instruction">LD DE,$0114</td>
</tr>
<tr>
<td class="address-1"><span id="64035"></span>FA23</td>
<td class="instruction">LD HL,$1401</td>
</tr>
<tr>
<td class="address-1"><span id="64038"></span>FA26</td>
<td class="instruction">CALL <a href="58323.html">$E3D3</a></td>
</tr>
<tr>
<td class="address-1"><span id="64041"></span>FA29</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64042"></span>
<div class="comments">
<div class="paragraph">
A missile is in mid-fire, work out what to do with it.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="64042"></span>FA2A</td>
<td class="instruction">LD BC,$F8B5</td>
<td class="comment-1" rowspan="1">Point <span class="register">BC</span> at the bounds table. (<a href="63669.html">F8B5</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="64045"></span>FA2D</td>
<td class="instruction">CALL <a href="61237.html">$EF35</a></td>
<td class="comment-1" rowspan="1">Update the missile's position.</td>
</tr>
<tr>
<td class="address-1"><span id="64048"></span>FA30</td>
<td class="instruction">LD A,$6D</td>
<td class="comment-1" rowspan="1">Use the ID of the missle. (<a href="37144.html">9118</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="64050"></span>FA32</td>
<td class="instruction">CALL <a href="43069.html">$A83D</a></td>
<td class="comment-1" rowspan="1">Draw it.</td>
</tr>
<tr>
<td class="address-1"><span id="64053"></span>FA35</td>
<td class="instruction">LD A,($F672)</td>
<td class="comment-1" rowspan="4">Is the change in X and Y both 0?</td>
</tr>
<tr>
<td class="address-1"><span id="64056"></span>FA38</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="64057"></span>FA39</td>
<td class="instruction">LD A,($F673)</td>
</tr>
<tr>
<td class="address-1"><span id="64060"></span>FA3C</td>
<td class="instruction">OR B</td>
</tr>
<tr>
<td class="address-1"><span id="64061"></span>FA3D</td>
<td class="instruction">JR Z,$FA44</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="64063"></span>FA3F</td>
<td class="instruction">LD (IX-$04),$FF</td>
<td class="comment-1" rowspan="1">Signal that the missile is firing and return.</td>
</tr>
<tr>
<td class="address-1"><span id="64067"></span>FA43</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64068"></span>
<div class="comments">
<div class="paragraph">
The missile is moving.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="64068"></span>FA44</td>
<td class="instruction">LD B,$0C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="64070"></span>FA46</td>
<td class="instruction">LD HL,$80A9</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the lightning bolt position table. (<a href="32937.html">80A9</a>)</td>
</tr>
<tr>
<td class="address-2"><span id="64073"></span>FA49</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Is the next lighting bolt inactive?</td>
</tr>
<tr>
<td class="address-1"><span id="64074"></span>FA4A</td>
<td class="instruction">CP $FF</td>
</tr>
<tr>
<td class="address-1"><span id="64076"></span>FA4C</td>
<td class="instruction">JR NZ,$FA56</td>
<td class="comment-1" rowspan="1">Jump forward if it isn't.</td>
</tr>
<tr>
<td class="address-2"><span id="64078"></span>FA4E</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="5">Otherwise move to the next entry.</td>
</tr>
<tr>
<td class="address-1"><span id="64079"></span>FA4F</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="64080"></span>FA50</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="64081"></span>FA51</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="64082"></span>FA52</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="64083"></span>FA53</td>
<td class="instruction">DJNZ $FA49</td>
<td class="comment-1" rowspan="1">Loop while there are still more lightning bolts to look at.</td>
</tr>
<tr>
<td class="address-1"><span id="64085"></span>FA55</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Otherwise return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64086"></span>
<div class="comments">
<div class="paragraph">
There is active lightning, did the missile hit it?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="64086"></span>FA56</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Put the lightning's x co-ordinate in <span class="register">E</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="64087"></span>FA57</td>
<td class="instruction">SUB (IX-$04)</td>
<td class="comment-1" rowspan="3">Is it close enough to the missile?</td>
</tr>
<tr>
<td class="address-1"><span id="64090"></span>FA5A</td>
<td class="instruction">SUB $08</td>
</tr>
<tr>
<td class="address-1"><span id="64092"></span>FA5C</td>
<td class="instruction">CP $F0</td>
</tr>
<tr>
<td class="address-1"><span id="64094"></span>FA5E</td>
<td class="instruction">JR C,$FA4E</td>
<td class="comment-1" rowspan="1">If not, jump back to check the next lightning.</td>
</tr>
<tr>
<td class="address-1"><span id="64096"></span>FA60</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="64097"></span>FA61</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Put the lightning's y co-ordinate  in <span class="register">D</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="64098"></span>FA62</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-1"><span id="64099"></span>FA63</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move back to the previous position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="64100"></span>FA64</td>
<td class="instruction">SUB (IX-$03)</td>
<td class="comment-1" rowspan="3">Is the y co-ordinate close enough to the missile?</td>
</tr>
<tr>
<td class="address-1"><span id="64103"></span>FA67</td>
<td class="instruction">SUB $08</td>
</tr>
<tr>
<td class="address-1"><span id="64105"></span>FA69</td>
<td class="instruction">CP $F0</td>
</tr>
<tr>
<td class="address-1"><span id="64107"></span>FA6B</td>
<td class="instruction">JR C,$FA4E</td>
<td class="comment-1" rowspan="1">Jump back if it isn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64109"></span>
<div class="comments">
<div class="paragraph">
The missile has hit some lightning.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="64109"></span>FA6D</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-1" rowspan="2">Signal there is no lightning here.</td>
</tr>
<tr>
<td class="address-1"><span id="64111"></span>FA6F</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="64112"></span>FA70</td>
<td class="instruction">LD ($F9F0),A</td>
<td class="comment-1" rowspan="1">Signal that the missile is no longer active.</td>
</tr>
<tr>
<td class="address-1"><span id="64115"></span>FA73</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="4">Move to the next place in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="64116"></span>FA74</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="64117"></span>FA75</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="64118"></span>FA76</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="64119"></span>FA77</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the object ID for the lightning.</td>
</tr>
<tr>
<td class="address-1"><span id="64120"></span>FA78</td>
<td class="instruction">CP $6B</td>
<td class="comment-1" rowspan="1">Is it 6B? (small lightning)</td>
</tr>
<tr>
<td class="address-1"><span id="64122"></span>FA7A</td>
<td class="instruction">JR Z,$FA86</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="64124"></span>FA7C</td>
<td class="instruction">LD A,$6B</td>
<td class="comment-1" rowspan="1">Set the UDG to a small lightning bolt. (<a href="37080.html">90D8</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="64126"></span>FA7E</td>
<td class="instruction">CALL <a href="64240.html">$FAF0</a></td>
<td class="comment-1" rowspan="2">Move the lightning bolts around.</td>
</tr>
<tr>
<td class="address-1"><span id="64129"></span>FA81</td>
<td class="instruction">CALL <a href="64240.html">$FAF0</a></td>
</tr>
<tr>
<td class="address-1"><span id="64132"></span>FA84</td>
<td class="instruction">JR $FAE3</td>
<td class="comment-1" rowspan="1">Jump forward to play the sound effect and return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64134"></span>
<div class="comments">
<div class="paragraph">
The missile hit some small lightning.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="64134"></span>FA86</td>
<td class="instruction">LD A,($FAEF)</td>
<td class="comment-1" rowspan="3">Flip the "regenerate lightning" bit.</td>
</tr>
<tr>
<td class="address-1"><span id="64137"></span>FA89</td>
<td class="instruction">XOR $01</td>
</tr>
<tr>
<td class="address-1"><span id="64139"></span>FA8B</td>
<td class="instruction">LD ($FAEF),A</td>
</tr>
<tr>
<td class="address-1"><span id="64142"></span>FA8E</td>
<td class="instruction">JR NZ,$FAE3</td>
<td class="comment-1" rowspan="1">Skip the next bit of code if the bit is set.</td>
</tr>
<tr>
<td class="address-1"><span id="64144"></span>FA90</td>
<td class="instruction">LD DE,$42EE</td>
<td class="comment-1" rowspan="5">Get bit 1 of <span class="register">R</span>, to generate a random flag, that determines the lightning comes in at the top right or the bottom left.</td>
</tr>
<tr>
<td class="address-1"><span id="64147"></span>FA93</td>
<td class="instruction">LD A,R</td>
</tr>
<tr>
<td class="address-1"><span id="64149"></span>FA95</td>
<td class="instruction">AND $01</td>
</tr>
<tr>
<td class="address-1"><span id="64151"></span>FA97</td>
<td class="instruction">JR NZ,$FA9C</td>
</tr>
<tr>
<td class="address-1"><span id="64153"></span>FA99</td>
<td class="instruction">LD DE,$AE02</td>
</tr>
<tr>
<td class="address-2"><span id="64156"></span>FA9C</td>
<td class="instruction">LD A,$38</td>
<td class="comment-1" rowspan="1">Set the UDG to a big lightning bolt. (<a href="35448.html">8A78</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="64158"></span>FA9E</td>
<td class="instruction">CALL <a href="64240.html">$FAF0</a></td>
<td class="comment-1" rowspan="1">Move the lightning bolts around.</td>
</tr>
<tr>
<td class="address-1"><span id="64161"></span>FAA1</td>
<td class="instruction">LD HL,$F9F4</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the number of asteroids left to hit. (<a href="63988.html">F9F4</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="64164"></span>FAA4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Have we destroyed all of them already?</td>
</tr>
<tr>
<td class="address-1"><span id="64165"></span>FAA5</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="64166"></span>FAA6</td>
<td class="instruction">JR Z,$FAE3</td>
<td class="comment-1" rowspan="1">Jump forward if we have.</td>
</tr>
<tr>
<td class="address-1"><span id="64168"></span>FAA8</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Otherwise decrement the count of asteroids left to hit.</td>
</tr>
<tr>
<td class="address-1"><span id="64169"></span>FAA9</td>
<td class="instruction">JR NZ,$FAE3</td>
<td class="comment-1" rowspan="1">Jump forward if the count is not zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64171"></span>
<div class="comments">
<div class="paragraph">
The player has destroyed enough asteroids to win the sub-game.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="64171"></span>FAAB</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="2">Set the asteroids game as completed.</td>
</tr>
<tr>
<td class="address-1"><span id="64173"></span>FAAD</td>
<td class="instruction">LD ($EC1C),A</td>
</tr>
<tr>
<td class="address-1"><span id="64176"></span>FAB0</td>
<td class="instruction">LD ($ECB3),A</td>
<td class="comment-1" rowspan="1">Set the task completed. (<a href="60508.html">EC5C</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="64179"></span>FAB3</td>
<td class="instruction">LD A,(IY-$1E)</td>
<td class="comment-1" rowspan="4">Earn the player £100.</td>
</tr>
<tr>
<td class="address-1"><span id="64182"></span>FAB6</td>
<td class="instruction">ADD A,$01</td>
</tr>
<tr>
<td class="address-1"><span id="64184"></span>FAB8</td>
<td class="instruction">DAA</td>
</tr>
<tr>
<td class="address-1"><span id="64185"></span>FAB9</td>
<td class="instruction">LD (IY-$1E),A</td>
</tr>
<tr>
<td class="address-1"><span id="64188"></span>FABC</td>
<td class="instruction">LD A,($ECFE)</td>
<td class="comment-1" rowspan="4">Add £100 to the grand total.</td>
</tr>
<tr>
<td class="address-1"><span id="64191"></span>FABF</td>
<td class="instruction">ADD A,$01</td>
</tr>
<tr>
<td class="address-1"><span id="64193"></span>FAC1</td>
<td class="instruction">DAA</td>
</tr>
<tr>
<td class="address-1"><span id="64194"></span>FAC2</td>
<td class="instruction">LD ($ECFE),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64197"></span>
<div class="comments">
<div class="paragraph">
Play the "completed" sound effect.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="64197"></span>FAC5</td>
<td class="instruction">LD BC,$BE32</td>
<td class="comment-1" rowspan="3">Set the parameters for the first sound.</td>
</tr>
<tr>
<td class="address-1"><span id="64200"></span>FAC8</td>
<td class="instruction">LD HL,$0000</td>
</tr>
<tr>
<td class="address-1"><span id="64203"></span>FACB</td>
<td class="instruction">LD DE,$0A0A</td>
</tr>
<tr>
<td class="address-1"><span id="64206"></span>FACE</td>
<td class="instruction">CALL <a href="64231.html">$FAE7</a></td>
<td class="comment-1" rowspan="1">Play it.</td>
</tr>
<tr>
<td class="address-1"><span id="64209"></span>FAD1</td>
<td class="instruction">LD BC,$9664</td>
<td class="comment-1" rowspan="1">Set the parameters for the second sound.</td>
</tr>
<tr>
<td class="address-1"><span id="64212"></span>FAD4</td>
<td class="instruction">CALL <a href="64231.html">$FAE7</a></td>
<td class="comment-1" rowspan="1">Play it.</td>
</tr>
<tr>
<td class="address-1"><span id="64215"></span>FAD7</td>
<td class="instruction">LD BC,$A532</td>
<td class="comment-1" rowspan="1">Set the parameters for the third sound.</td>
</tr>
<tr>
<td class="address-1"><span id="64218"></span>FADA</td>
<td class="instruction">CALL <a href="64231.html">$FAE7</a></td>
<td class="comment-1" rowspan="1">Play it.</td>
</tr>
<tr>
<td class="address-1"><span id="64221"></span>FADD</td>
<td class="instruction">LD BC,$7D78</td>
<td class="comment-1" rowspan="1">Set the parameter for the fourth sound.</td>
</tr>
<tr>
<td class="address-1"><span id="64224"></span>FAE0</td>
<td class="instruction">CALL <a href="64231.html">$FAE7</a></td>
<td class="comment-1" rowspan="1">Play it.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="64227"></span>
<div class="comments">
<div class="paragraph">
This code is a common entry point if lightining was hit.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="64227"></span>FAE3</td>
<td class="instruction">CALL <a href="63940.html">$F9C4</a></td>
<td class="comment-1" rowspan="2">Play the "hit lighting" sound effect and return.</td>
</tr>
<tr>
<td class="address-1"><span id="64230"></span>FAE6</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63988.html">F9F4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63989">Map</a></td>
<td class="next">
Next: <a href="64231.html">FAE7</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>