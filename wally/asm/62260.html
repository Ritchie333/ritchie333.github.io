<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F334</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Everyone's A Wally</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62256.html">F330</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62260">Map</a></td>
<td class="next">
Next: <a href="62325.html">F375</a>
</td>
</tr>
</table>
<div class="description">F334: Room logic : The Zoo</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62260"></span>F334</td>
<td class="instruction">LD A,$08</td>
<td class="comment-1" rowspan="2">Touching a banana drops endurance by 8.</td>
</tr>
<tr>
<td class="address-1"><span id="62262"></span>F336</td>
<td class="instruction">LD ($F26E),A</td>
</tr>
<tr>
<td class="address-1"><span id="62265"></span>F339</td>
<td class="instruction">LD IX,$F327</td>
<td class="comment-1" rowspan="1">Point <span class="register">IX</span> at the data for this room.</td>
</tr>
<tr>
<td class="address-1"><span id="62269"></span>F33D</td>
<td class="instruction">LD BC,$F330</td>
<td class="comment-1" rowspan="1">Set the bounds.</td>
</tr>
<tr>
<td class="address-1"><span id="62272"></span>F340</td>
<td class="instruction">CALL <a href="61237.html">$EF35</a></td>
<td class="comment-1" rowspan="1">Update moving objects.</td>
</tr>
<tr>
<td class="address-1"><span id="62275"></span>F343</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="1">Get the current object ID. (<a href="36728.html">8F78</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="62278"></span>F346</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment it.</td>
</tr>
<tr>
<td class="address-1"><span id="62279"></span>F347</td>
<td class="instruction">CP $64</td>
<td class="comment-1" rowspan="1">Is it now 40?</td>
</tr>
<tr>
<td class="address-1"><span id="62281"></span>F349</td>
<td class="instruction">JR NZ,$F34D</td>
<td class="comment-1" rowspan="1">Skip the next bit if not.</td>
</tr>
<tr>
<td class="address-1"><span id="62283"></span>F34B</td>
<td class="instruction">LD A,$60</td>
<td class="comment-1" rowspan="1">Otherwise reset to ID 60.</td>
</tr>
<tr>
<td class="address-2"><span id="62285"></span>F34D</td>
<td class="instruction">LD (IX+$00),A</td>
<td class="comment-1" rowspan="1">Set the new object ID.</td>
</tr>
<tr>
<td class="address-1"><span id="62288"></span>F350</td>
<td class="instruction">CALL <a href="43069.html">$A83D</a></td>
<td class="comment-1" rowspan="1">Draw the object.</td>
</tr>
<tr>
<td class="address-1"><span id="62291"></span>F353</td>
<td class="instruction">INC IX</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="62293"></span>F355</td>
<td class="instruction">CALL <a href="61237.html">$EF35</a></td>
<td class="comment-1" rowspan="1">Update moving objects.</td>
</tr>
<tr>
<td class="address-1"><span id="62296"></span>F358</td>
<td class="instruction">LD A,$64</td>
<td class="comment-1" rowspan="1">Point <span class="register">A</span> at the object ID for the banana. (<a href="36856.html">8FF8</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="62298"></span>F35A</td>
<td class="instruction">CALL <a href="43069.html">$A83D</a></td>
<td class="comment-1" rowspan="1">Draw the object.</td>
</tr>
<tr>
<td class="address-1"><span id="62301"></span>F35D</td>
<td class="instruction">CALL <a href="58153.html">$E329</a></td>
<td class="comment-1" rowspan="1">Check for collision detection.</td>
</tr>
<tr>
<td class="address-1"><span id="62304"></span>F360</td>
<td class="instruction">LD A,(IX-$01)</td>
<td class="comment-1" rowspan="1">Get the Y direction change.</td>
</tr>
<tr>
<td class="address-1"><span id="62307"></span>F363</td>
<td class="instruction">CP $FE</td>
<td class="comment-1" rowspan="1">Is it now trying to move upwards?</td>
</tr>
<tr>
<td class="address-1"><span id="62309"></span>F365</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62310"></span>
<div class="comments">
<div class="paragraph">
The banana has hit the boundary, instead of reversing direction, draw it again from the start.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62310"></span>F366</td>
<td class="instruction">LD (IX-$03),$6E</td>
<td class="comment-1" rowspan="1">Set the Y co-ordinate back to 6E.</td>
</tr>
<tr>
<td class="address-1"><span id="62314"></span>F36A</td>
<td class="instruction">LD (IX-$01),$02</td>
<td class="comment-1" rowspan="1">Set the direction change back to 2 downwards.</td>
</tr>
<tr>
<td class="address-1"><span id="62318"></span>F36E</td>
<td class="instruction">LD A,(IX-$09)</td>
<td class="comment-1" rowspan="2">Set the X co-ordinate to the same as the monkey, so it looks like the monkey has directly thrown the banana.</td>
</tr>
<tr>
<td class="address-1"><span id="62321"></span>F371</td>
<td class="instruction">LD (IX-$04),A</td>
</tr>
<tr>
<td class="address-1"><span id="62324"></span>F374</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62256.html">F330</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62260">Map</a></td>
<td class="next">
Next: <a href="62325.html">F375</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>