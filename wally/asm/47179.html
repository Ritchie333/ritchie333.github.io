<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at B84B</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="47147.html">B82B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47179">Map</a></td>
<td class="next">
Next: <a href="47300.html">B8C4</a>
</td>
</tr>
</table>
<div class="description">B84B: Draw a room graphic</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="46019.html">B3C3</a>, <a href="47147.html">B82B</a>, <a href="47442.html">B952</a>, <a href="47726.html">BA6E</a>, <a href="47796.html">BAB4</a>, <a href="58365.html">E3FD</a>, <a href="58472.html">E468</a> and <a href="60919.html">EDF7</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">The address of the graphic to draw</td>
</tr>
<tr>
<td class="register">D</td>
<td class="register-desc">The y co-ordinate</td>
</tr>
<tr>
<td class="register">E</td>
<td class="register-desc">The x co-ordinate</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="47179"></span>B84B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the next byte.</td>
</tr>
<tr>
<td class="address-1"><span id="47180"></span>B84C</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47181"></span>B84D</td>
<td class="instruction">CP $80</td>
<td class="comment-1" rowspan="1">Is the byte less than 80?</td>
</tr>
<tr>
<td class="address-1"><span id="47183"></span>B84F</td>
<td class="instruction">JR C,Draw_Graphic_10</td>
<td class="comment-1" rowspan="1">Jump forward if so.</td>
</tr>
<tr>
<td class="address-1"><span id="47185"></span>B851</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1">Is the byte the end marker FF?</td>
</tr>
<tr>
<td class="address-1"><span id="47187"></span>B853</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so.</td>
</tr>
<tr>
<td class="address-1"><span id="47188"></span>B854</td>
<td class="instruction">CP $FE</td>
<td class="comment-1" rowspan="1">Is this a change attribute marker FE?</td>
</tr>
<tr>
<td class="address-1"><span id="47190"></span>B856</td>
<td class="instruction">JR NZ,Draw_Graphic_1</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="address-1"><span id="47192"></span>B858</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">Put the next byte in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="47193"></span>B859</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47194"></span>B85A</td>
<td class="instruction">JR Draw_Graphic</td>
<td class="comment-1" rowspan="1">Jump back to look at the rest of the data.</td>
</tr>
<tr>
<td class="address-2"><span id="47196"></span>B85C</td>
<td class="instruction">CP $A8</td>
<td class="comment-1" rowspan="1">Is the byte less than A8?</td>
</tr>
<tr>
<td class="address-1"><span id="47198"></span>B85E</td>
<td class="instruction">JR C,Draw_Graphic_10</td>
<td class="comment-1" rowspan="1">Jump forward if so.</td>
</tr>
<tr>
<td class="address-1"><span id="47200"></span>B860</td>
<td class="instruction">CP $E8</td>
<td class="comment-1" rowspan="1">Is the byte greater than E8?</td>
</tr>
<tr>
<td class="address-1"><span id="47202"></span>B862</td>
<td class="instruction">JR NC,Draw_Graphic_2</td>
<td class="comment-1" rowspan="1">Jump forward if so.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47204"></span>
<div class="comments">
<div class="paragraph">
Move to a new position.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="47204"></span>B864</td>
<td class="instruction">SUB $C8</td>
<td class="comment-1" rowspan="3">Subtract C8 to get the actual x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="47206"></span>B866</td>
<td class="instruction">ADD A,E</td>
</tr>
<tr>
<td class="address-1"><span id="47207"></span>B867</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="47208"></span>B868</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="3">Add the next byte to the current y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="47209"></span>B869</td>
<td class="instruction">ADD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="47210"></span>B86A</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-1"><span id="47211"></span>B86B</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47212"></span>B86C</td>
<td class="instruction">JR Draw_Graphic</td>
<td class="comment-1" rowspan="1">Jump back to draw some more.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47214"></span>
<div class="comments">
<div class="paragraph">
Check to see if this is an address marker.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47214"></span>B86E</td>
<td class="instruction">CP $FB</td>
<td class="comment-1" rowspan="1">Is the byte an address marker? (FB)</td>
</tr>
<tr>
<td class="address-1"><span id="47216"></span>B870</td>
<td class="instruction">JR NZ,Draw_Graphic_3</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47218"></span>
<div class="comments">
<div class="paragraph">
Change the base address.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="47218"></span>B872</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the low byte.</td>
</tr>
<tr>
<td class="address-1"><span id="47219"></span>B873</td>
<td class="instruction">LD ($B7E9),A</td>
<td class="comment-1" rowspan="1">Set this in the printing routine.</td>
</tr>
<tr>
<td class="address-1"><span id="47222"></span>B876</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47223"></span>B877</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the high byte.</td>
</tr>
<tr>
<td class="address-1"><span id="47224"></span>B878</td>
<td class="instruction">LD ($B7EA),A</td>
<td class="comment-1" rowspan="1">Set this in the printing routine.</td>
</tr>
<tr>
<td class="address-1"><span id="47227"></span>B87B</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47228"></span>B87C</td>
<td class="instruction">JR Draw_Graphic</td>
<td class="comment-1" rowspan="1">Jump back to draw some more.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47230"></span>
<div class="comments">
<div class="paragraph">
Check some more control bytes.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47230"></span>B87E</td>
<td class="instruction">CP $F1</td>
<td class="comment-1" rowspan="1">Is the a "move a column" marker? (F1)</td>
</tr>
<tr>
<td class="address-1"><span id="47232"></span>B880</td>
<td class="instruction">JR Z,Draw_Graphic_11</td>
<td class="comment-1" rowspan="1">Jump if so.</td>
</tr>
<tr>
<td class="address-1"><span id="47234"></span>B882</td>
<td class="instruction">CP $F3</td>
<td class="comment-1" rowspan="1">Is this a "sub block" marker? (F3)</td>
</tr>
<tr>
<td class="address-1"><span id="47236"></span>B884</td>
<td class="instruction">JR NZ,Draw_Graphic_4</td>
<td class="comment-1" rowspan="1">Jump if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47238"></span>
<div class="comments">
<div class="paragraph">
Chain to block data at another address.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="47238"></span>B886</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Put the new block marker in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="47239"></span>B887</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="47240"></span>B888</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="47241"></span>B889</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="47242"></span>B88A</td>
<td class="instruction">JR Draw_Graphic</td>
<td class="comment-1" rowspan="1">Jump back to draw some more.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47244"></span>
<div class="comments">
<div class="paragraph">
Check some more control bytes.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47244"></span>B88C</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">Get the number of rows or columns in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="47245"></span>B88D</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47246"></span>B88E</td>
<td class="instruction">CP $F0</td>
<td class="comment-1" rowspan="1">Is this a "row repeat" instruction? (F0)</td>
</tr>
<tr>
<td class="address-1"><span id="47248"></span>B890</td>
<td class="instruction">JR NZ,Draw_Graphic_6</td>
<td class="comment-1" rowspan="1">Move forward if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47250"></span>
<div class="comments">
<div class="paragraph">
Repeat this graphic for a number of rows.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="47250"></span>B892</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the next byte.</td>
</tr>
<tr>
<td class="address-1"><span id="47251"></span>B893</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-2"><span id="47252"></span>B894</td>
<td class="instruction">CALL Print_Graphic</td>
<td class="comment-1" rowspan="1">Put the graphic on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="47255"></span>B897</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move to the next row.</td>
</tr>
<tr>
<td class="address-1"><span id="47256"></span>B898</td>
<td class="instruction">DJNZ Draw_Graphic_5</td>
<td class="comment-1" rowspan="1">Repeat while there are more rows.</td>
</tr>
<tr>
<td class="address-1"><span id="47258"></span>B89A</td>
<td class="instruction">JR Draw_Graphic</td>
<td class="comment-1" rowspan="1">Jump back to draw some more.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47260"></span>
<div class="comments">
<div class="paragraph">
Check some more control bytes.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47260"></span>B89C</td>
<td class="instruction">CP $F2</td>
<td class="comment-1" rowspan="1">Is this a "block column repeat" instruction? (F2)</td>
</tr>
<tr>
<td class="address-1"><span id="47262"></span>B89E</td>
<td class="instruction">JR NZ,Draw_Graphic_8</td>
<td class="comment-1" rowspan="1">Jump foward if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47264"></span>
<div class="comments">
<div class="paragraph">
Repeat this graphic for a number of pairs of columns.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47264"></span>B8A0</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the next byte.</td>
</tr>
<tr>
<td class="address-1"><span id="47265"></span>B8A1</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47266"></span>B8A2</td>
<td class="instruction">CALL Print_Graphic</td>
<td class="comment-1" rowspan="1">Put the graphic on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="47269"></span>B8A5</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the next byte.</td>
</tr>
<tr>
<td class="address-1"><span id="47270"></span>B8A6</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move to the next column.</td>
</tr>
<tr>
<td class="address-1"><span id="47271"></span>B8A7</td>
<td class="instruction">CALL Print_Graphic</td>
<td class="comment-1" rowspan="1">Put the graphic on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="47274"></span>B8AA</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move to the next column.</td>
</tr>
<tr>
<td class="address-1"><span id="47275"></span>B8AB</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move back in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47276"></span>B8AC</td>
<td class="instruction">DJNZ Draw_Graphic_7</td>
<td class="comment-1" rowspan="1">Repeat until all columns are drawn.</td>
</tr>
<tr>
<td class="address-1"><span id="47278"></span>B8AE</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Move forward to the correct position in the buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="47279"></span>B8AF</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="47280"></span>B8B0</td>
<td class="instruction">JR Draw_Graphic</td>
<td class="comment-1" rowspan="1">Jump back to draw some more.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47282"></span>
<div class="comments">
<div class="paragraph">
Otherwise, the instruction must be "column repeat" (FD), so repeat this graphic for a number of columns.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47282"></span>B8B2</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Get the next byte.</td>
</tr>
<tr>
<td class="address-1"><span id="47283"></span>B8B3</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the buffer.</td>
</tr>
<tr>
<td class="address-2"><span id="47284"></span>B8B4</td>
<td class="instruction">CALL Print_Graphic</td>
<td class="comment-1" rowspan="1">Put the graphic on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="47287"></span>B8B7</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move forward a column.</td>
</tr>
<tr>
<td class="address-1"><span id="47288"></span>B8B8</td>
<td class="instruction">DJNZ Draw_Graphic_9</td>
<td class="comment-1" rowspan="1">Loop while there is more to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="47290"></span>B8BA</td>
<td class="instruction">JP Draw_Graphic</td>
<td class="comment-1" rowspan="1">Otherwise jump back to draw some more.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="47293"></span>
<div class="comments">
<div class="paragraph">
Simple instruction - display a graphic
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="47293"></span>B8BD</td>
<td class="instruction">CALL Print_Graphic</td>
<td class="comment-1" rowspan="1">Put the graphic on screen.</td>
</tr>
<tr>
<td class="address-2"><span id="47296"></span>B8C0</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move forward a column.</td>
</tr>
<tr>
<td class="address-1"><span id="47297"></span>B8C1</td>
<td class="instruction">JP Draw_Graphic</td>
<td class="comment-1" rowspan="1">Jump back to draw some more.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="47147.html">B82B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47179">Map</a></td>
<td class="next">
Next: <a href="47300.html">B8C4</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>