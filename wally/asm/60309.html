<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at EB95</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="60281.html">EB79</a>
</td>
<td class="up">Up: <a href="../maps/all.html#60309">Map</a></td>
<td class="next">
Next: <a href="60356.html">EBC4</a>
</td>
</tr>
</table>
<div class="description">EB95: Pattern 0 AT OBJ(x) : Match if at an item</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
-
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">: Points to the room's object ID to test for</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="60309"></span>EB95</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">Put the object to test for in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="60310"></span>EB96</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Ensure <span class="register">HL</span> points to the next pattern.</td>
</tr>
<tr>
<td class="address-1"><span id="60311"></span>EB97</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Store this.</td>
</tr>
<tr>
<td class="address-1"><span id="60312"></span>EB98</td>
<td class="instruction">LD A,($EB54)</td>
<td class="comment-1" rowspan="1">Get the current ID of the item the player is next to, if any.</td>
</tr>
<tr>
<td class="address-1"><span id="60315"></span>EB9B</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Was there one?</td>
</tr>
<tr>
<td class="address-1"><span id="60316"></span>EB9C</td>
<td class="instruction">JR NZ,$EBC0</td>
<td class="comment-1" rowspan="1">Jump forward if not.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60318"></span>
<div class="comments">
<div class="paragraph">
There's an item here, is it the right one.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="60318"></span>EB9E</td>
<td class="instruction">LD (IY-$2D),B</td>
<td class="comment-1" rowspan="1">Put the ID of the object to test in the buffer at <a href="48186.html">BC3A</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="60321"></span>EBA1</td>
<td class="instruction">CALL <a href="43660.html">$AA8C</a></td>
<td class="comment-1" rowspan="1">Get the object's data.</td>
</tr>
<tr>
<td class="address-1"><span id="60324"></span>EBA4</td>
<td class="instruction">LD A,(IY+$05)</td>
<td class="comment-1" rowspan="1">Get the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="60327"></span>EBA7</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point to the item's X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="60328"></span>EBA8</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="3">Is is near enough?</td>
</tr>
<tr>
<td class="address-1"><span id="60329"></span>EBA9</td>
<td class="instruction">SUB $04</td>
</tr>
<tr>
<td class="address-1"><span id="60331"></span>EBAB</td>
<td class="instruction">CP $F8</td>
</tr>
<tr>
<td class="address-1"><span id="60333"></span>EBAD</td>
<td class="instruction">JR C,$EBC0</td>
<td class="comment-1" rowspan="1">If it isn't, jump forward to set the pattern as not matched.</td>
</tr>
<tr>
<td class="address-1"><span id="60335"></span>EBAF</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point to the item's Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="60336"></span>EBB0</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="1">Get the player's Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="60339"></span>EBB3</td>
<td class="instruction">ADD A,$10</td>
<td class="comment-1" rowspan="4">Is it near enough?</td>
</tr>
<tr>
<td class="address-1"><span id="60341"></span>EBB5</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="60342"></span>EBB6</td>
<td class="instruction">SUB $04</td>
</tr>
<tr>
<td class="address-1"><span id="60344"></span>EBB8</td>
<td class="instruction">CP $F8</td>
</tr>
<tr>
<td class="address-1"><span id="60346"></span>EBBA</td>
<td class="instruction">JR C,$EBC0</td>
<td class="comment-1" rowspan="1">If not, jump forward to set the pattern as not matched.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60348"></span>
<div class="comments">
<div class="paragraph">
There's the right object here, and the player is near enough to it.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="60348"></span>EBBC</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the address of the next pattern in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="60349"></span>EBBD</td>
<td class="instruction">JP <a href="60095.html#60107">$EACB</a></td>
<td class="comment-1" rowspan="1">Carry on looking at other patterns.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60352"></span>
<div class="comments">
<div class="paragraph">
There's no item here, or it's not the right one.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60352"></span>EBC0</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the address of the next pattern in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="60353"></span>EBC1</td>
<td class="instruction">JP <a href="60131.html">$EAE3</a></td>
<td class="comment-1" rowspan="1">Flag the pattern has having not matched.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="60281.html">EB79</a>
</td>
<td class="up">Up: <a href="../maps/all.html#60309">Map</a></td>
<td class="next">
Next: <a href="60356.html">EBC4</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>