<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F43C</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62473.html">F409</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62524">Map</a></td>
<td class="next">
Next: <a href="62609.html">F491</a>
</td>
</tr>
</table>
<div class="description">F43C: Room logic : Wall Street</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62524"></span>F43C</td>
<td class="instruction">LD A,$09</td>
<td class="comment-1" rowspan="2">Is flag 9 (wall built) set?</td>
</tr>
<tr>
<td class="address-1"><span id="62526"></span>F43E</td>
<td class="instruction">CALL Get_Flag</td>
</tr>
<tr>
<td class="address-1"><span id="62529"></span>F441</td>
<td class="instruction">JR Z,Logic_Wall_Street_2</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="62531"></span>F443</td>
<td class="instruction">LD A,$06</td>
<td class="comment-1" rowspan="2">Is flag 6 (battery charged) set?</td>
</tr>
<tr>
<td class="address-1"><span id="62533"></span>F445</td>
<td class="instruction">CALL Get_Flag</td>
</tr>
<tr>
<td class="address-1"><span id="62536"></span>F448</td>
<td class="instruction">JR Z,Logic_Wall_Street_2</td>
<td class="comment-1" rowspan="1">Jump forward if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="62538"></span>F44A</td>
<td class="instruction">LD A,(Wall_Street_items)</td>
<td class="comment-1" rowspan="2">Is the battery the first item in the room?</td>
</tr>
<tr>
<td class="address-1"><span id="62541"></span>F44D</td>
<td class="instruction">CP $04</td>
</tr>
<tr>
<td class="address-1"><span id="62543"></span>F44F</td>
<td class="instruction">JR NZ,Logic_Wall_Street_2</td>
<td class="comment-1" rowspan="1">Jump forward if it isn't.</td>
</tr>
<tr>
<td class="address-1"><span id="62545"></span>F451</td>
<td class="instruction">LD A,(IY+$05)</td>
<td class="comment-1" rowspan="1">Get the x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="62548"></span>F454</td>
<td class="instruction">SUB $42</td>
<td class="comment-1" rowspan="2">Is it by the fork lift?</td>
</tr>
<tr>
<td class="address-1"><span id="62550"></span>F456</td>
<td class="instruction">CP $FC</td>
</tr>
<tr>
<td class="address-1"><span id="62552"></span>F458</td>
<td class="instruction">JR C,Logic_Wall_Street_2</td>
<td class="comment-1" rowspan="1">Jump foward if it isn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62554"></span>
<div class="comments">
<div class="paragraph">
The fork lift truck has a charged battery and the player is standing by the lift, so it can be activated.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62554"></span>F45A</td>
<td class="instruction">LD A,($AF88)</td>
<td class="comment-1" rowspan="1">Get the fork lift's position.</td>
</tr>
<tr>
<td class="address-1"><span id="62557"></span>F45D</td>
<td class="instruction">SUB (IY+$0A)</td>
<td class="comment-1" rowspan="3">Is the player standing on it?</td>
</tr>
<tr>
<td class="address-1"><span id="62560"></span>F460</td>
<td class="instruction">SUB $22</td>
</tr>
<tr>
<td class="address-1"><span id="62562"></span>F462</td>
<td class="instruction">CP $FC</td>
</tr>
<tr>
<td class="address-1"><span id="62564"></span>F464</td>
<td class="instruction">JR C,Logic_Wall_Street_2</td>
<td class="comment-1" rowspan="1">Jump forward if they aren't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62566"></span>
<div class="comments">
<div class="paragraph">
The player is standing on the fork lift, so move it.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62566"></span>F466</td>
<td class="instruction">LD A,($AF88)</td>
<td class="comment-1" rowspan="1">Get the fork lift's position.</td>
</tr>
<tr>
<td class="address-1"><span id="62569"></span>F469</td>
<td class="instruction">SUB $02</td>
<td class="comment-1" rowspan="1">Move it up two positions.</td>
</tr>
<tr>
<td class="address-1"><span id="62571"></span>F46B</td>
<td class="instruction">CP $78</td>
<td class="comment-1" rowspan="3">Restrict the height to 78</td>
</tr>
<tr>
<td class="address-1"><span id="62573"></span>F46D</td>
<td class="instruction">JR NC,Logic_Wall_Street_1</td>
</tr>
<tr>
<td class="address-1"><span id="62575"></span>F46F</td>
<td class="instruction">LD A,$78</td>
</tr>
<tr>
<td class="address-2"><span id="62577"></span>F471</td>
<td class="instruction">LD ($AF88),A</td>
<td class="comment-1" rowspan="1">Set the new height.</td>
</tr>
<tr>
<td class="address-1"><span id="62580"></span>F474</td>
<td class="instruction">SUB $20</td>
<td class="comment-1" rowspan="2">Set the player's y co-ordinate above the lift.</td>
</tr>
<tr>
<td class="address-1"><span id="62582"></span>F476</td>
<td class="instruction">LD (IY+$0A),A</td>
</tr>
<tr>
<td class="address-2"><span id="62585"></span>F479</td>
<td class="instruction">LD A,($AF88)</td>
<td class="comment-1" rowspan="1">Get the fork lift's position.</td>
</tr>
<tr>
<td class="address-1"><span id="62588"></span>F47C</td>
<td class="instruction">LD B,$10</td>
<td class="comment-1" rowspan="5">Invert it to get a y co-ordinate on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="62590"></span>F47E</td>
<td class="instruction">CP $B8</td>
</tr>
<tr>
<td class="address-1"><span id="62592"></span>F480</td>
<td class="instruction">JR Z,Logic_Wall_Street_3</td>
</tr>
<tr>
<td class="address-1"><span id="62594"></span>F482</td>
<td class="instruction">LD B,$0E</td>
</tr>
<tr>
<td class="address-2"><span id="62596"></span>F484</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="address-1"><span id="62597"></span>F485</td>
<td class="instruction">LD H,A</td>
<td class="comment-1" rowspan="1">Set the y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="62598"></span>F486</td>
<td class="instruction">LD L,$40</td>
<td class="comment-1" rowspan="1">x co-ordinate is always 40.</td>
</tr>
<tr>
<td class="address-1"><span id="62600"></span>F488</td>
<td class="instruction">LD (Draw_XPos),HL</td>
<td class="comment-1" rowspan="1">Set the position of the fork lift.</td>
</tr>
<tr>
<td class="address-1"><span id="62603"></span>F48B</td>
<td class="instruction">LD A,$2B</td>
<td class="comment-1" rowspan="1">Set the ID of the fork lift. (<a href="35032.html">88D8</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="62605"></span>F48D</td>
<td class="instruction">CALL Draw_Non_Mask</td>
<td class="comment-1" rowspan="2">Draw the object and return.</td>
</tr>
<tr>
<td class="address-1"><span id="62608"></span>F490</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62473.html">F409</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62524">Map</a></td>
<td class="next">
Next: <a href="62609.html">F491</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>