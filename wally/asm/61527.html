<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F057</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61511.html">F047</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61527">Map</a></td>
<td class="next">
Next: <a href="61623.html">F0B7</a>
</td>
</tr>
</table>
<div class="description">F057: Chase : Update the shark</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="61383.html">EFC7</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="61527"></span>F057</td>
<td class="instruction">LD A,($F046)</td>
<td class="comment-1" rowspan="1">Get the shark's direction.</td>
</tr>
<tr>
<td class="address-1"><span id="61530"></span>F05A</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is it facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="61531"></span>F05B</td>
<td class="instruction">CALL NZ,<a href="61511.html">$F047</a></td>
<td class="comment-1" rowspan="1">If not, reverse the graphic so it is.</td>
</tr>
<tr>
<td class="address-1"><span id="61534"></span>F05E</td>
<td class="instruction">LD HL,($F0BD)</td>
<td class="comment-1" rowspan="2">Put the x co-ordinate in <span class="register">L</span> and set the y co-ordinate to 98.</td>
</tr>
<tr>
<td class="address-1"><span id="61537"></span>F061</td>
<td class="instruction">LD H,$98</td>
</tr>
<tr>
<td class="address-1"><span id="61539"></span>F063</td>
<td class="instruction">LD A,$30</td>
<td class="comment-1" rowspan="1">Set the object ID to be the shark's head (88F8)</td>
</tr>
<tr>
<td class="address-1"><span id="61541"></span>F065</td>
<td class="instruction">LD ($A838),HL</td>
<td class="comment-1" rowspan="1">Set the position.</td>
</tr>
<tr>
<td class="address-1"><span id="61544"></span>F068</td>
<td class="instruction">CALL <a href="43168.html">$A8A0</a></td>
<td class="comment-1" rowspan="1">Put the object in the sprite buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="61547"></span>F06B</td>
<td class="instruction">LD H,$A8</td>
<td class="comment-1" rowspan="1">Set the y co-ordinate to A8.</td>
</tr>
<tr>
<td class="address-1"><span id="61549"></span>F06D</td>
<td class="instruction">LD ($A838),HL</td>
<td class="comment-1" rowspan="1">Set the position.</td>
</tr>
<tr>
<td class="address-1"><span id="61552"></span>F070</td>
<td class="instruction">LD A,($F3A0)</td>
<td class="comment-1" rowspan="1">Get the object ID of the shark's body.</td>
</tr>
<tr>
<td class="address-1"><span id="61555"></span>F073</td>
<td class="instruction">XOR $02</td>
<td class="comment-1" rowspan="2">Toggle bit 2, so it alternates between 2D and 2F.</td>
</tr>
<tr>
<td class="address-1"><span id="61557"></span>F075</td>
<td class="instruction">LD ($F3A0),A</td>
</tr>
<tr>
<td class="address-1"><span id="61560"></span>F078</td>
<td class="instruction">CALL <a href="43168.html">$A8A0</a></td>
<td class="comment-1" rowspan="1">Put the object in the sprite buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="61563"></span>F07B</td>
<td class="instruction">LD A,$0C</td>
<td class="comment-1" rowspan="2">Touching the shark drops endurance by 0C.</td>
</tr>
<tr>
<td class="address-1"><span id="61565"></span>F07D</td>
<td class="instruction">LD ($F26E),A</td>
</tr>
<tr>
<td class="address-1"><span id="61568"></span>F080</td>
<td class="instruction">CALL <a href="58153.html">$E329</a></td>
<td class="comment-1" rowspan="1">Check for collision detection.</td>
</tr>
<tr>
<td class="address-1"><span id="61571"></span>F083</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="1">Get the player's Y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="61574"></span>F086</td>
<td class="instruction">CP $98</td>
<td class="comment-1" rowspan="1">Is it 98 ie: ground level.</td>
</tr>
<tr>
<td class="address-1"><span id="61576"></span>F088</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if it is, chase hasn't started.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61577"></span>
<div class="comments">
<div class="paragraph">
The chase is on.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="61577"></span>F089</td>
<td class="instruction">LD HL,$F0BD</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> to the shark's x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="61580"></span>F08C</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Has the shark caught up with the player?</td>
</tr>
<tr>
<td class="address-1"><span id="61581"></span>F08D</td>
<td class="instruction">SUB (IY+$05)</td>
</tr>
<tr>
<td class="address-1"><span id="61584"></span>F090</td>
<td class="instruction">SUB $01</td>
</tr>
<tr>
<td class="address-1"><span id="61586"></span>F092</td>
<td class="instruction">CP $FE</td>
</tr>
<tr>
<td class="address-1"><span id="61588"></span>F094</td>
<td class="instruction">JR NC,$F09A</td>
<td class="comment-1" rowspan="1">Jump forward if it has, it doesn't need to chase any more.</td>
</tr>
<tr>
<td class="address-1"><span id="61590"></span>F096</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="3">Otherwise decrement the X co-ordinate by 2.</td>
</tr>
<tr>
<td class="address-1"><span id="61591"></span>F097</td>
<td class="instruction">SUB $02</td>
</tr>
<tr>
<td class="address-1"><span id="61593"></span>F099</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-2"><span id="61594"></span>F09A</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Is the shark close enough to the player to attack?</td>
</tr>
<tr>
<td class="address-1"><span id="61595"></span>F09B</td>
<td class="instruction">SUB (IY+$05)</td>
</tr>
<tr>
<td class="address-1"><span id="61598"></span>F09E</td>
<td class="instruction">SUB $0C</td>
</tr>
<tr>
<td class="address-1"><span id="61600"></span>F0A0</td>
<td class="instruction">CP $E0</td>
</tr>
<tr>
<td class="address-1"><span id="61602"></span>F0A2</td>
<td class="instruction">JR C,$F0AE</td>
<td class="comment-1" rowspan="1">Jump forward if it isn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61604"></span>
<div class="comments">
<div class="paragraph">
The shark is close enough to attack the player, so don't make them advance otherwise they'll overtake and not attack anymore.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="61604"></span>F0A4</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Increment the X co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="61605"></span>F0A5</td>
<td class="instruction">LD A,($F0E4)</td>
<td class="comment-1" rowspan="1">Get the number of ticks in this run.</td>
</tr>
<tr>
<td class="address-1"><span id="61608"></span>F0A8</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment it.</td>
</tr>
<tr>
<td class="address-1"><span id="61609"></span>F0A9</td>
<td class="instruction">CP $05</td>
<td class="comment-1" rowspan="2">Return if it doesn't equal 5 yet.</td>
</tr>
<tr>
<td class="address-1"><span id="61611"></span>F0AB</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="address-1"><span id="61612"></span>F0AC</td>
<td class="instruction">JR $F0B3</td>
<td class="comment-1" rowspan="1">Otherwise set it to that value.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61614"></span>
<div class="comments">
<div class="paragraph">
The shark isn't close enough yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="61614"></span>F0AE</td>
<td class="instruction">LD A,($F0E4)</td>
<td class="comment-1" rowspan="1">Get the number of ticks in this run.</td>
</tr>
<tr>
<td class="address-1"><span id="61617"></span>F0B1</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrement it.</td>
</tr>
<tr>
<td class="address-1"><span id="61618"></span>F0B2</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if it doesn't equal 0 yet.</td>
</tr>
<tr>
<td class="address-2"><span id="61619"></span>F0B3</td>
<td class="instruction">LD ($F0E4),A</td>
<td class="comment-1" rowspan="2">Otherwise set it to that value and return.</td>
</tr>
<tr>
<td class="address-1"><span id="61622"></span>F0B6</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61511.html">F047</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61527">Map</a></td>
<td class="next">
Next: <a href="61623.html">F0B7</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>