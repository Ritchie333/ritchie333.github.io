<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F3AB</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62371.html">F3A3</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62379">Map</a></td>
<td class="next">
Next: <a href="62461.html">F3FD</a>
</td>
</tr>
</table>
<div class="description">F3AB: Room logic : The Sewer</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62379"></span>F3AB</td>
<td class="instruction">LD A,$40</td>
<td class="comment-1" rowspan="2">Touching the shark drops endurance by 64, which can kill a player pretty quickly.</td>
</tr>
<tr>
<td class="address-1"><span id="62381"></span>F3AD</td>
<td class="instruction">LD ($F26E),A</td>
</tr>
<tr>
<td class="address-1"><span id="62384"></span>F3B0</td>
<td class="instruction">LD IX,$F3A3</td>
<td class="comment-1" rowspan="1">Point <span class="register">IX</span> to the movement table. (<a href="62371.html">F3A3</a>)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62388"></span>
<div class="comments">
<div class="paragraph">
Make sure the shark is facing the right way.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62388"></span>F3B4</td>
<td class="instruction">LD A,(IX+$02)</td>
<td class="comment-1" rowspan="1">Get the distance to move in X.</td>
</tr>
<tr>
<td class="address-1"><span id="62391"></span>F3B7</td>
<td class="instruction">CP $02</td>
<td class="comment-1" rowspan="1">Compare it to +2 ie: moving right.</td>
</tr>
<tr>
<td class="address-1"><span id="62393"></span>F3B9</td>
<td class="instruction">LD A,($F046)</td>
<td class="comment-1" rowspan="1">Get the shark's direction.</td>
</tr>
<tr>
<td class="address-1"><span id="62396"></span>F3BC</td>
<td class="instruction">JR Z,$F3C4</td>
<td class="comment-1" rowspan="1">If the distance is positive, nothing to do.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62398"></span>
<div class="comments">
<div class="paragraph">
Shark should be facing left.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62398"></span>F3BE</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is the direction 0? (left)</td>
</tr>
<tr>
<td class="address-1"><span id="62399"></span>F3BF</td>
<td class="instruction">CALL NZ,<a href="61511.html">$F047</a></td>
<td class="comment-1" rowspan="2">If not, need to flip the shark the other way round.</td>
</tr>
<tr>
<td class="address-1"><span id="62402"></span>F3C2</td>
<td class="instruction">JR $F3C8</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62404"></span>
<div class="comments">
<div class="paragraph">
Shark should be facing right.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62404"></span>F3C4</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is the direction 0? (left)</td>
</tr>
<tr>
<td class="address-1"><span id="62405"></span>F3C5</td>
<td class="instruction">CALL Z,<a href="61511.html">$F047</a></td>
<td class="comment-1" rowspan="1">If so, need to flip the shark the other way round.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62408"></span>
<div class="comments">
<div class="paragraph">
Now draw the shark.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="62408"></span>F3C8</td>
<td class="instruction">LD A,$30</td>
<td class="comment-1" rowspan="1">Set the object ID to be the shark's head.</td>
</tr>
<tr>
<td class="address-1"><span id="62410"></span>F3CA</td>
<td class="instruction">LD BC,$F3A1</td>
<td class="comment-1" rowspan="1">Point <span class="register">BC</span> to the bounds table. (<a href="62369.html">F3A1</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="62413"></span>F3CD</td>
<td class="instruction">CALL <a href="61237.html">$EF35</a></td>
<td class="comment-1" rowspan="1">Update the position.</td>
</tr>
<tr>
<td class="address-1"><span id="62416"></span>F3D0</td>
<td class="instruction">CALL <a href="43168.html">$A8A0</a></td>
<td class="comment-1" rowspan="1">Draw the graphic.</td>
</tr>
<tr>
<td class="address-1"><span id="62419"></span>F3D3</td>
<td class="instruction">LD A,($F3A0)</td>
<td class="comment-1" rowspan="1">Get the next ID for the shark's body.</td>
</tr>
<tr>
<td class="address-1"><span id="62422"></span>F3D6</td>
<td class="instruction">XOR $02</td>
<td class="comment-1" rowspan="2">Cycle bit 2 so it changes between 2D and 2F.</td>
</tr>
<tr>
<td class="address-1"><span id="62424"></span>F3D8</td>
<td class="instruction">LD ($F3A0),A</td>
</tr>
<tr>
<td class="address-1"><span id="62427"></span>F3DB</td>
<td class="instruction">CALL <a href="61237.html">$EF35</a></td>
<td class="comment-1" rowspan="1">Update the position.</td>
</tr>
<tr>
<td class="address-1"><span id="62430"></span>F3DE</td>
<td class="instruction">CALL <a href="43168.html">$A8A0</a></td>
<td class="comment-1" rowspan="1">Draw the graphic.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62433"></span>
<div class="comments">
<div class="paragraph">
Check to see if the player has the meat.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62433"></span>F3E1</td>
<td class="instruction">LD A,($BD78)</td>
<td class="comment-1" rowspan="1">Get the item in the sewer.</td>
</tr>
<tr>
<td class="address-1"><span id="62436"></span>F3E4</td>
<td class="instruction">CP $17</td>
<td class="comment-1" rowspan="1">Is it the meat?</td>
</tr>
<tr>
<td class="address-1"><span id="62438"></span>F3E6</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">If so, the shark won't harm the player, so return.</td>
</tr>
<tr>
<td class="address-1"><span id="62439"></span>F3E7</td>
<td class="instruction">LD A,$17</td>
<td class="comment-1" rowspan="2">Otherwise, is the player's first item the meat?</td>
</tr>
<tr>
<td class="address-1"><span id="62441"></span>F3E9</td>
<td class="instruction">CP (IY+$50)</td>
</tr>
<tr>
<td class="address-1"><span id="62444"></span>F3EC</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if it is.</td>
</tr>
<tr>
<td class="address-1"><span id="62445"></span>F3ED</td>
<td class="instruction">CP (IY+$55)</td>
<td class="comment-1" rowspan="1">Otherwise, is the player's second item the meat?</td>
</tr>
<tr>
<td class="address-1"><span id="62448"></span>F3F0</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if it is.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="62449"></span>
<div class="comments">
<div class="paragraph">
The player doesn't have the meat, if they touch the shark it's bad news.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="62449"></span>F3F1</td>
<td class="instruction">LD A,($A839)</td>
<td class="comment-1" rowspan="4">Move up two rows and check collision detection.</td>
</tr>
<tr>
<td class="address-1"><span id="62452"></span>F3F4</td>
<td class="instruction">SUB $10</td>
</tr>
<tr>
<td class="address-1"><span id="62454"></span>F3F6</td>
<td class="instruction">LD ($A839),A</td>
</tr>
<tr>
<td class="address-1"><span id="62457"></span>F3F9</td>
<td class="instruction">CALL <a href="58153.html">$E329</a></td>
</tr>
<tr>
<td class="address-1"><span id="62460"></span>F3FC</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="62371.html">F3A3</a>
</td>
<td class="up">Up: <a href="../maps/all.html#62379">Map</a></td>
<td class="next">
Next: <a href="62461.html">F3FD</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>