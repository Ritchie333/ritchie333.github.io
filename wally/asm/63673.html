<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F8B9</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Everyone's A Wally</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63669.html">F8B5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63673">Map</a></td>
<td class="next">
Next: <a href="63802.html">F93A</a>
</td>
</tr>
</table>
<div class="description">F8B9: Asteroids : Check for collision with lightning</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="60919.html">EDF7</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63673"></span>F8B9</td>
<td class="instruction">LD IX,$80A9</td>
<td class="comment-1" rowspan="1">Point <span class="register">IX</span> at the movement table.</td>
</tr>
<tr>
<td class="address-1"><span id="63677"></span>F8BD</td>
<td class="instruction">LD A,$08</td>
<td class="comment-1" rowspan="2">Moving objects decrease endurance by 8.</td>
</tr>
<tr>
<td class="address-1"><span id="63679"></span>F8BF</td>
<td class="instruction">LD ($F26E),A</td>
</tr>
<tr>
<td class="address-1"><span id="63682"></span>F8C2</td>
<td class="instruction">LD B,$0C</td>
<td class="comment-1" rowspan="1">0C entries to check.</td>
</tr>
<tr>
<td class="address-2"><span id="63684"></span>F8C4</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Remember the count in <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63685"></span>F8C5</td>
<td class="instruction">LD BC,$F8B5</td>
<td class="comment-1" rowspan="1">Point <span class="register">BC</span> at the bounds table. (<a href="63669.html">F8B5</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="63688"></span>F8C8</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="63691"></span>F8CB</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="63693"></span>F8CD</td>
<td class="instruction">JR NZ,$F8D6</td>
<td class="comment-1" rowspan="1">Jump forward if it isn't.</td>
</tr>
<tr>
<td class="address-1"><span id="63695"></span>F8CF</td>
<td class="instruction">CALL <a href="61237.html#61320">$EF88</a></td>
<td class="comment-1" rowspan="3">Move to the next entry and return.</td>
</tr>
<tr>
<td class="address-1"><span id="63698"></span>F8D2</td>
<td class="instruction">INC IX</td>
</tr>
<tr>
<td class="address-1"><span id="63700"></span>F8D4</td>
<td class="instruction">JR $F936</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63702"></span>
<div class="comments">
<div class="paragraph">
The lightning bolt is active.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63702"></span>F8D6</td>
<td class="instruction">CALL <a href="61237.html">$EF35</a></td>
<td class="comment-1" rowspan="1">Update the position.</td>
</tr>
<tr>
<td class="address-1"><span id="63705"></span>F8D9</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="1">Get the current graphic ID.</td>
</tr>
<tr>
<td class="address-1"><span id="63708"></span>F8DC</td>
<td class="instruction">CALL <a href="43168.html">$A8A0</a></td>
<td class="comment-1" rowspan="1">Put it in the sprite buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="63711"></span>F8DF</td>
<td class="instruction">INC IX</td>
<td class="comment-1" rowspan="1">Move to the next position in the table.</td>
</tr>
<tr>
<td class="address-1"><span id="63713"></span>F8E1</td>
<td class="instruction">LD A,(IY+$05)</td>
<td class="comment-1" rowspan="1">Get the player's x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63716"></span>F8E4</td>
<td class="instruction">SUB (IX-$05)</td>
<td class="comment-1" rowspan="3">Is it close enough to the lightning?</td>
</tr>
<tr>
<td class="address-1"><span id="63719"></span>F8E7</td>
<td class="instruction">SUB $08</td>
</tr>
<tr>
<td class="address-1"><span id="63721"></span>F8E9</td>
<td class="instruction">CP $F0</td>
</tr>
<tr>
<td class="address-1"><span id="63723"></span>F8EB</td>
<td class="instruction">JR C,$F8FA</td>
<td class="comment-1" rowspan="1">Jump forward if it isn't.</td>
</tr>
<tr>
<td class="address-1"><span id="63725"></span>F8ED</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="1">Get the player's y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63728"></span>F8F0</td>
<td class="instruction">SUB (IX-$04)</td>
<td class="comment-1" rowspan="3">Is it close enough to the lightning?</td>
</tr>
<tr>
<td class="address-1"><span id="63731"></span>F8F3</td>
<td class="instruction">SUB $08</td>
</tr>
<tr>
<td class="address-1"><span id="63733"></span>F8F5</td>
<td class="instruction">CP $F0</td>
</tr>
<tr>
<td class="address-1"><span id="63735"></span>F8F7</td>
<td class="instruction">CALL NC,<a href="58153.html#58175">$E33F</a></td>
<td class="comment-1" rowspan="1">If it is, the player has hit the lightning, so decrease endurance.</td>
</tr>
<tr>
<td class="address-2"><span id="63738"></span>F8FA</td>
<td class="instruction">LD A,($F672)</td>
<td class="comment-1" rowspan="2">Has the missile hit a boundary in X?</td>
</tr>
<tr>
<td class="address-1"><span id="63741"></span>F8FD</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="63742"></span>F8FE</td>
<td class="instruction">JR Z,$F918</td>
<td class="comment-1" rowspan="1">Jump forward if it hasn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63744"></span>
<div class="comments">
<div class="paragraph">
If the missile hits a boundary, the usual logic for moving objects needs changing. Instead of reversing direction, move to the other end of the screen, and keep the existing direction.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63744"></span>F900</td>
<td class="instruction">LD A,(IX-$05)</td>
<td class="comment-1" rowspan="6">If the position is F0 set it to 02. Otherwise, it must be 0, so set it to EE.</td>
</tr>
<tr>
<td class="address-1"><span id="63747"></span>F903</td>
<td class="instruction">CP $F0</td>
</tr>
<tr>
<td class="address-1"><span id="63749"></span>F905</td>
<td class="instruction">JR Z,$F90B</td>
</tr>
<tr>
<td class="address-1"><span id="63751"></span>F907</td>
<td class="instruction">LD A,$EE</td>
</tr>
<tr>
<td class="address-1"><span id="63753"></span>F909</td>
<td class="instruction">JR $F90D</td>
</tr>
<tr>
<td class="address-2"><span id="63755"></span>F90B</td>
<td class="instruction">LD A,$02</td>
</tr>
<tr>
<td class="address-2"><span id="63757"></span>F90D</td>
<td class="instruction">LD (IX-$05),A</td>
<td class="comment-1" rowspan="1">Set the new x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63760"></span>F910</td>
<td class="instruction">LD A,(IX-$03)</td>
<td class="comment-1" rowspan="3">Restore the sign of the direction, that was changed in the previous call to <a href="61237.html">EF35</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="63763"></span>F913</td>
<td class="instruction">NEG</td>
</tr>
<tr>
<td class="address-1"><span id="63765"></span>F915</td>
<td class="instruction">LD (IX-$03),A</td>
</tr>
<tr>
<td class="address-2"><span id="63768"></span>F918</td>
<td class="instruction">LD A,($F673)</td>
<td class="comment-1" rowspan="2">Has the missile hit a boundary in Y?</td>
</tr>
<tr>
<td class="address-1"><span id="63771"></span>F91B</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="63772"></span>F91C</td>
<td class="instruction">JR Z,$F936</td>
<td class="comment-1" rowspan="1">Jump forward if it hasn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63774"></span>
<div class="comments">
<div class="paragraph">
Update the boundary logic as earlier.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63774"></span>F91E</td>
<td class="instruction">LD A,(IX-$04)</td>
<td class="comment-1" rowspan="6">If the position is 40 set it to AE. Otherwise it must be B0 so set it to 42.</td>
</tr>
<tr>
<td class="address-1"><span id="63777"></span>F921</td>
<td class="instruction">CP $40</td>
</tr>
<tr>
<td class="address-1"><span id="63779"></span>F923</td>
<td class="instruction">JR NZ,$F929</td>
</tr>
<tr>
<td class="address-1"><span id="63781"></span>F925</td>
<td class="instruction">LD A,$AE</td>
</tr>
<tr>
<td class="address-1"><span id="63783"></span>F927</td>
<td class="instruction">JR $F92B</td>
</tr>
<tr>
<td class="address-2"><span id="63785"></span>F929</td>
<td class="instruction">LD A,$42</td>
</tr>
<tr>
<td class="address-2"><span id="63787"></span>F92B</td>
<td class="instruction">LD (IX-$04),A</td>
<td class="comment-1" rowspan="1">Set the new y co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63790"></span>F92E</td>
<td class="instruction">LD A,(IX-$02)</td>
<td class="comment-1" rowspan="3">Restore the sign of the direction, that was changed in the previous call to <a href="61237.html">EF35</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="63793"></span>F931</td>
<td class="instruction">NEG</td>
</tr>
<tr>
<td class="address-1"><span id="63795"></span>F933</td>
<td class="instruction">LD (IX-$02),A</td>
</tr>
<tr>
<td class="address-2"><span id="63798"></span>F936</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the count in <span class="register">BC</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63799"></span>F937</td>
<td class="instruction">DJNZ $F8C4</td>
<td class="comment-1" rowspan="1">Loop while there is more lightning to draw.</td>
</tr>
<tr>
<td class="address-1"><span id="63801"></span>F939</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Otherwise return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63669.html">F8B5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63673">Map</a></td>
<td class="next">
Next: <a href="63802.html">F93A</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
</footer>
</body>
</html>