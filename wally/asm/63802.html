<!DOCTYPE html>
<html>
<head>
<title>Everyone's A Wally: Routine at F93A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="loading" src="../images/loading.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63673.html">F8B9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63802">Map</a></td>
<td class="next">
Next: <a href="63908.html">F9A4</a>
</td>
</tr>
</table>
<div class="description">F93A: Asteroids : Check for player's movement</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="60919.html">EDF7</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63802"></span>F93A</td>
<td class="instruction">CALL <a href="45116.html">$B03C</a></td>
<td class="comment-1" rowspan="2">Was 'left' pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="63805"></span>F93D</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="63806"></span>F93E</td>
<td class="instruction">JR Z,$F94E</td>
<td class="comment-1" rowspan="1">Jump forward if it wasn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63808"></span>
<div class="comments">
<div class="paragraph">
'left' was pressed, so rotate anticlockwise.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63808"></span>F940</td>
<td class="instruction">DEC (IY+$00)</td>
<td class="comment-1" rowspan="1">Decrement the graphic used for the player.</td>
</tr>
<tr>
<td class="address-1"><span id="63811"></span>F943</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="4">If it's now 6D past the end of usable sprites, set it to the maximum of 75.</td>
</tr>
<tr>
<td class="address-1"><span id="63814"></span>F946</td>
<td class="instruction">CP $6D</td>
</tr>
<tr>
<td class="address-1"><span id="63816"></span>F948</td>
<td class="instruction">JR NZ,$F94E</td>
</tr>
<tr>
<td class="address-1"><span id="63818"></span>F94A</td>
<td class="instruction">LD (IY+$00),$75</td>
</tr>
<tr>
<td class="address-2"><span id="63822"></span>F94E</td>
<td class="instruction">CALL Detect_Right</td>
<td class="comment-1" rowspan="2">Was 'right' pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="63825"></span>F951</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="63826"></span>F952</td>
<td class="instruction">JR Z,$F962</td>
<td class="comment-1" rowspan="1">Jump forward if it wasn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63828"></span>
<div class="comments">
<div class="paragraph">
'right' was pressed, so rotate clockwise.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63828"></span>F954</td>
<td class="instruction">INC (IY+$00)</td>
<td class="comment-1" rowspan="1">Increment the graphic used for the player.</td>
</tr>
<tr>
<td class="address-1"><span id="63831"></span>F957</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="4">If it's now 75 past the end of usable sprites, set it to the minimum of 6E.</td>
</tr>
<tr>
<td class="address-1"><span id="63834"></span>F95A</td>
<td class="instruction">CP $76</td>
</tr>
<tr>
<td class="address-1"><span id="63836"></span>F95C</td>
<td class="instruction">JR NZ,$F962</td>
</tr>
<tr>
<td class="address-1"><span id="63838"></span>F95E</td>
<td class="instruction">LD (IY+$00),$6E</td>
</tr>
<tr>
<td class="address-2"><span id="63842"></span>F962</td>
<td class="instruction">CALL Detect_In</td>
<td class="comment-1" rowspan="2">Was 'in' pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="63845"></span>F965</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="address-1"><span id="63846"></span>F966</td>
<td class="instruction">JR Z,$F994</td>
<td class="comment-1" rowspan="1">Jump forward if it wasn't.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63848"></span>
<div class="comments">
<div class="paragraph">
'in' was pressed, so move forward.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="63848"></span>F968</td>
<td class="instruction">CALL Space_Get_Deltas</td>
<td class="comment-1" rowspan="1">Put the change in co-ordinates in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="63851"></span>F96B</td>
<td class="instruction">LD A,(IY+$05)</td>
<td class="comment-1" rowspan="1">Get the x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63854"></span>F96E</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="1">Add the offset (may be negative).</td>
</tr>
<tr>
<td class="address-1"><span id="63855"></span>F96F</td>
<td class="instruction">JR NZ,$F975</td>
<td class="comment-1" rowspan="3">If the x co-ordinate is 0, wrap around to EE.</td>
</tr>
<tr>
<td class="address-1"><span id="63857"></span>F971</td>
<td class="instruction">LD A,$EE</td>
</tr>
<tr>
<td class="address-1"><span id="63859"></span>F973</td>
<td class="instruction">JR $F97B</td>
</tr>
<tr>
<td class="address-2"><span id="63861"></span>F975</td>
<td class="instruction">CP $F0</td>
<td class="comment-1" rowspan="3">If the x co-ordinate is F0 wrap around to 02.</td>
</tr>
<tr>
<td class="address-1"><span id="63863"></span>F977</td>
<td class="instruction">JR NZ,$F97B</td>
</tr>
<tr>
<td class="address-1"><span id="63865"></span>F979</td>
<td class="instruction">LD A,$02</td>
</tr>
<tr>
<td class="address-2"><span id="63867"></span>F97B</td>
<td class="instruction">LD (IY+$05),A</td>
<td class="comment-1" rowspan="1">Set the new x co-ordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="63870"></span>F97E</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next position in the table.</td>
</tr>
<tr>
<td class="address-1"><span id="63871"></span>F97F</td>
<td class="instruction">LD A,(IY+$0A)</td>
<td class="comment-1" rowspan="1">Get the y co-ordinate</td>
</tr>
<tr>
<td class="address-1"><span id="63874"></span>F982</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="1">Add the offset (may be negative).</td>
</tr>
<tr>
<td class="address-1"><span id="63875"></span>F983</td>
<td class="instruction">CP $40</td>
<td class="comment-1" rowspan="4">If the y co-ordinate is 40 wrap around to AC.</td>
</tr>
<tr>
<td class="address-1"><span id="63877"></span>F985</td>
<td class="instruction">JR NZ,$F98B</td>
</tr>
<tr>
<td class="address-1"><span id="63879"></span>F987</td>
<td class="instruction">LD A,$AC</td>
</tr>
<tr>
<td class="address-1"><span id="63881"></span>F989</td>
<td class="instruction">JR $F991</td>
</tr>
<tr>
<td class="address-2"><span id="63883"></span>F98B</td>
<td class="instruction">CP $AE</td>
<td class="comment-1" rowspan="3">If the y co-ordinate is AE wrap around to 42.</td>
</tr>
<tr>
<td class="address-1"><span id="63885"></span>F98D</td>
<td class="instruction">JR NZ,$F991</td>
</tr>
<tr>
<td class="address-1"><span id="63887"></span>F98F</td>
<td class="instruction">LD A,$42</td>
</tr>
<tr>
<td class="address-2"><span id="63889"></span>F991</td>
<td class="instruction">LD (IY+$0A),A</td>
<td class="comment-1" rowspan="1">Set the new y co-ordinate.</td>
</tr>
<tr>
<td class="address-2"><span id="63892"></span>F994</td>
<td class="instruction">LD L,(IY+$05)</td>
<td class="comment-1" rowspan="3">Set the co-ordinates as the location to draw. (<a href="43064.html">A838</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="63895"></span>F997</td>
<td class="instruction">LD H,(IY+$0A)</td>
</tr>
<tr>
<td class="address-1"><span id="63898"></span>F99A</td>
<td class="instruction">LD (Draw_XPos),HL</td>
</tr>
<tr>
<td class="address-1"><span id="63901"></span>F99D</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="1">Use the current sprite ID for the player.</td>
</tr>
<tr>
<td class="address-1"><span id="63904"></span>F9A0</td>
<td class="instruction">CALL Draw_Non_Mask</td>
<td class="comment-1" rowspan="2">Draw it and return.</td>
</tr>
<tr>
<td class="address-1"><span id="63907"></span>F9A3</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63673.html">F8B9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63802">Map</a></td>
<td class="next">
Next: <a href="63908.html">F9A4</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">(c) 1985 Mikro-Gen (code and graphics), 2013-2023 Ritchie Swann / Paul Maddern (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>